{"version":3,"sources":["/prj/user/asm/Asms.tonyu","/prj/user/asm/FldIdx.tonyu","/prj/user/asm/gen/Buf.tonyu","/prj/user/asm/gen/Context.tonyu","/prj/user/asm/gen/StringBuilder.tonyu","/prj/user/asm/gen/VisitorBase.tonyu","/prj/user/asm/Includer.tonyu","/prj/user/asm/MBoot.tonyu","/prj/user/asm/MemberScan.tonyu","/prj/user/asm/nodes/C_Meta.tonyu","/prj/user/asm/nodes/ForHead.tonyu","/prj/user/asm/nodes/FuncInfo.tonyu","/prj/user/asm/nodes/Locals.tonyu","/prj/user/asm/nodes/TNode.tonyu","/prj/user/asm/nodes/Try.tonyu","/prj/user/asm/nodes/TypeDecl.tonyu","/prj/user/asm/nodes/TypeExpr.tonyu","/prj/user/asm/nodes/VarDecl.tonyu","/prj/user/asm/nodes/VarsDecl.tonyu","/prj/user/asm/nodes/While.tonyu","/prj/user/asm/Visitor.tonyu","/prj/user/spr/OutBG.tonyu","/prj/user/spr/OutPat.tonyu","/prj/user/spr/RSprite.tonyu","/prj/user/spr/RSprPat.tonyu","/prj/user/asm/GenAsm.tonyu","/prj/user/asm/nodes/ArgList.tonyu","/prj/user/asm/nodes/ArrayElem.tonyu","/prj/user/asm/nodes/Break.tonyu","/prj/user/asm/nodes/Call.tonyu","/prj/user/asm/nodes/Case.tonyu","/prj/user/asm/nodes/Catch.tonyu","/prj/user/asm/nodes/Compound.tonyu","/prj/user/asm/nodes/Continue.tonyu","/prj/user/asm/nodes/Default.tonyu","/prj/user/asm/nodes/Do.tonyu","/prj/user/asm/nodes/Exprstmt.tonyu","/prj/user/asm/nodes/Extends.tonyu","/prj/user/asm/nodes/Finally.tonyu","/prj/user/asm/nodes/For.tonyu","/prj/user/asm/nodes/Forin.tonyu","/prj/user/asm/nodes/FuncDecl.tonyu","/prj/user/asm/nodes/FuncDeclHead.tonyu","/prj/user/asm/nodes/FuncExprArg.tonyu","/prj/user/asm/nodes/FuncExprHead.tonyu","/prj/user/asm/nodes/If.tonyu","/prj/user/asm/nodes/IfWait.tonyu","/prj/user/asm/nodes/Includes.tonyu","/prj/user/asm/nodes/Infix.tonyu","/prj/user/asm/nodes/JsonElem.tonyu","/prj/user/asm/nodes/Member.tonyu","/prj/user/asm/nodes/NativeDecl.tonyu","/prj/user/asm/nodes/NormalFor.tonyu","/prj/user/asm/nodes/ObjlitArg.tonyu","/prj/user/asm/nodes/ParamDecl.tonyu","/prj/user/asm/nodes/ParamDecls.tonyu","/prj/user/asm/nodes/Postfix.tonyu","/prj/user/asm/nodes/Prefix.tonyu","/prj/user/asm/nodes/Program.tonyu","/prj/user/asm/nodes/Return.tonyu","/prj/user/asm/nodes/Scall.tonyu","/prj/user/asm/nodes/SetterDecl.tonyu","/prj/user/asm/nodes/Switch.tonyu","/prj/user/asm/nodes/Throw.tonyu","/prj/user/asm/nodes/Trifix.tonyu","/prj/user/asm/RActor.tonyu","/prj/user/EBullet.tonyu","/prj/user/Enemy.tonyu","/prj/user/Main.tonyu","/prj/user/PBullet.tonyu","/prj/user/Player.tonyu","/prj/user/asm/nodes/FuncExpr.tonyu","/prj/user/asm/nodes/NewExpr.tonyu","/prj/user/asm/nodes/Objlit.tonyu","/prj/user/asm/nodes/ParenExpr.tonyu","/prj/user/asm/nodes/SuperExpr.tonyu","/prj/user/asm/nodes/Token.tonyu","/prj/user/asm/nodes/VarAccess.tonyu","/prj/user/asm/nodes/Arylit.tonyu"],"names":[],"mappings":"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","sourcesContent":["extends TObject;\r\nlet data={'main':`org 09000h\r\n\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude sp\r\ninclude vdp\r\ninclude th\r\n\r\n\r\n;===your code \r\n\r\nmain:\r\nld a,5\r\nlp:\r\ndec b\r\nshow a\r\niff nc,nx\r\njr lp\r\nnx:\r\n\r\nret\r\nend main`,\r\n    'math':`include ctrl\r\n\r\n;16bit shifts\r\nmacro slhl\r\n sla l\r\n rl h\r\nendm\r\nmacro srahl\r\n sra h\r\n rr l\r\nendm\r\nmacro srlhl\r\n srl h\r\n rr l\r\nendm\r\nmacro slde\r\n sla e\r\n rl d\r\nendm\r\nmacro srade\r\n sra d\r\n rr e\r\nendm\r\nmacro srlde\r\n srl d\r\n rr e\r\nendm\r\nmacro slbc\r\n sla c\r\n rl b\r\nendm\r\nmacro srabc\r\n sra b\r\n rr c\r\nendm\r\nmacro srlbc\r\n srl b\r\n rr c\r\nendm\r\n\r\n\r\n; for xrnd\r\nmacro sldehl,n\r\n  local loop\r\n  ld b,n\r\n loop:\r\n  sla d\r\n  rl e\r\n  rl h\r\n  rl l\r\n  djnz loop\r\nendm\r\nmacro srdehl,n\r\n local loop\r\n ld b,n\r\n loop:\r\n  srl l\r\n  rr h\r\n  rr e\r\n  rr d\r\n djnz loop\r\nendm\r\n \r\nmacro xorrm,re,me\r\n  ld A,(me)\r\n  xor re\r\n  ld (me),a\r\nendm\r\n\r\nmacro subhl,rp\r\n and a\r\n sbc hl,rp\r\nendm\r\n\r\nmacro cpde.a\r\n rst dcompr\r\nendm\r\n\r\n\r\nmarker.b xrnd.a\r\nxrnd.a:\r\nproc \r\n local rhl,rde,rdhlde\r\n ; s[0] ^= s[0] << 13\r\n call rdhlde\r\n sldehl 13\r\n call wrtxor\r\n ; s[0] ^= s[0] >> 17\r\n call rdhlde\r\n srdehl 17\r\n call wrtxor\r\n ; s[0] ^= s[0] << 5;\r\n call rdhlde\r\n sldehl 5\r\n call wrtxor\r\n ret\r\n \r\n rdhlde:\r\n  ld hl,1234\r\n rhl:\r\n  ld de,5678\r\n rde:\r\n  ret\r\n \r\n wrtxor:\r\n  xorrm h,rhl-1\r\n  xorrm l,rhl-2\r\n  xorrm d,rde-1\r\n  xorrm e,rde-2\r\n  ret\r\nendp\r\nmarker.e xrnd.a\r\n\r\n\r\nmarker.b rnd\r\nrnd:\r\n push af\r\n call rnd.a\r\n pop af\r\n ret\r\nmarker.e rnd\r\nmarker.b rnd.a\r\nrnd.a:\r\n ld de,07fffh\r\n call IDIV.a\r\n push hl\r\n call xrnd.a\r\n res 7,h\r\n ex de,hl\r\n pop hl\r\n inc hl\r\n call IDIV.a\r\n ret\r\nmarker.e rnd.a\r\n\r\nmarker.b abs\r\nabs:\r\n bit 7,h\r\n ret z\r\nneghl:\r\n ld de,0 \r\n ex de,hl \r\n subhl de\r\n ret\r\nmarker.e abs\r\n\r\n `,\r\n    'bool':`include math\r\ninclude ctrl\r\ntrue equ -1\r\nfalse equ 0\r\n\r\nmacro rethl,val,flg\r\n local tru\r\n if not nul flg\r\n  iff flg ,tru\r\n endif\r\n ld hl,val\r\n ret\r\n tru:\r\nendm\r\n\r\nhleqde:\r\n subhl de\r\n rethl true,z\r\n rethl false\r\n\r\nhlnede:\r\n subhl de\r\n rethl true,nz\r\n rethl false\r\n \r\nhlgtde:\r\n subhl de\r\n rethl false,z\r\n bit 7,h\r\n rethl true,z\r\n rethl false\r\n\r\nhlltde:\r\n subhl de\r\n bit 7,h\r\n rethl true,nz\r\n rethl false\r\n \r\nhlgede:\r\n subhl de\r\n rethl true,z\r\n bit 7,h\r\n rethl true,z\r\n rethl false\r\n\r\nhllede:\r\n subhl de\r\n rethl true,z\r\n bit 7,h\r\n rethl true,nz\r\n rethl false\r\n \r\nproc\r\nziffalse:\r\n local resa\r\n ld (resa-1),a\r\n call ziffalse.a\r\n ld A,0\r\n resa:\r\n ret\r\nziffalse.a:\r\n ld a,0\r\n cp h\r\n ret nz\r\n cp l\r\n ret\r\nendp\r\n\r\nmacro jpf,to\r\n call ziffalse\r\n jp z,to\r\nendm\r\n\r\nmacro andand,fls\r\n jpf fls\r\nendm\r\nmacro oror,tru\r\n call ziffalse\r\n jp nz,tru\r\nendm\r\n\r\nmacro flagtobool,fl\r\n local yes,skp\r\n jr fl, yes\r\n ld hl,false\r\n jr skp\r\n yes:\r\n ld hl,true\r\n skp: \r\nendm`,\r\n    'mem':`include const\r\n;\r\nrdslt:\r\n ex de,hl\r\n rept 5\r\n srl d;page*2\r\n endm\r\n CALL RSLREG\r\n ld e,d\r\n rdslt1:\r\n  RRCA\r\n  dec e\r\n  jp nz,rdslt1\r\n AND    00000011B\r\n LD C,A;000000Pr\r\n LD B,0\r\n LD HL,EXPTBL\r\n ADD HL,BC\r\n LD C,A;000000Pr\r\n LD A,(HL)\r\n AND 80H;expand flag\r\n OR C\r\n LD C,A;e00000Pr\r\n rept 4;const\r\n INC HL\r\n endm\r\n LD A,(HL);exp reg\r\n ld e,d\r\n rdslt2:\r\n  srl a\r\n  dec e\r\n  jp nz,rdslt2\r\n;000000Ex\r\n sla a\r\n sla a\r\n ;    0000Ex00\r\n and  00001100b\r\n OR C;e000ExPr\r\n ret\r\nmemini:\r\n CALL RSLREG\r\n rept 4\r\n  RRCA\r\n endm\r\n AND    00000011B\r\n LD C,A;000000Pr\r\n LD B,0\r\n LD HL,EXPTBL\r\n ADD HL,BC\r\n LD C,A;000000Pr\r\n LD A,(HL)\r\n AND 80H;expand flag\r\n OR C\r\n LD C,A;e00000Pr\r\n rept 4;const\r\n INC HL\r\n endm\r\n LD A,(HL);exp reg\r\n rept 4; page*2\r\n srl a\r\n endm;000000Ex\r\n sla a\r\n sla a\r\n ;    0000Ex00\r\n and  00001100b\r\n OR C;e000ExPr\r\n LD Hl,04000H\r\n jp ENASLT\r\n\r\nmacro peekw ,regv,regm\r\n  local w\r\n  ld (w-2),regm\r\n  ld regv,(0)\r\n  w:\r\nendm\r\n\r\nmacro pokew ,regm,regv\r\n  local w\r\n  ld (w-2),regm\r\n  ld (0),regv\r\n  w:\r\nendm\r\nmacro movw,dst,src,rp\r\n if nul rp\r\n  push hl\r\n  movw dst,src,hl\r\n  pop hl\r\n else\r\n  ld rp,src\r\n  ld dst,rp\r\n endif \r\nendm\r\n\r\nmacro popa\r\n  ex (sp),hl\r\n  ld a,h\r\n  pop HL\r\nendm\r\n\r\nmacro pushall\r\n push af\r\n push bc\r\n push de\r\n push hl\r\nendm\r\nmacro popall\r\n pop hl\r\n pop de\r\n pop bc\r\n pop af\r\nendm\r\n \r\n\r\nmacro pushi, n,rp\r\n local rrr\r\n if nul rp\r\n  ld (rrr-2),hl\r\n  ld hl,n\r\n  push hl\r\n  ld hl,0\r\n  rrr:\r\n else\r\n  ld rp,n\r\n  push rp\r\n endif\r\nendm\r\nmacro const,n,reg\r\n ld (n-2),reg\r\nendm\r\nmacro ldconst,reg,n\r\n ld reg,0\r\n n:\r\nendm\r\nmacro peekconst,reg,n\r\n ld reg,(0)\r\n n:\r\nendm\r\n`,\r\n    'const':`\r\n;wrt equ 0a2h\r\ndcompr equ 0020H\r\nsp.ini equ 0dc00h\r\nstksize equ 512\r\n\r\nth.size equ 256\r\nth.count equ 20\r\nth.start equ th.end-th.size*th.count\r\nth.end equ sp.ini-stksize\r\n\r\nth.bottom equ 0\r\n\r\nspr.scale equ 1\r\nspr.xmax equ 256<<spr.scale\r\nspr.ymax equ 192<<spr.scale\r\n\r\nENASLT EQU 0024H\r\nRSLREG EQU 0138H\r\nEXPTBL EQU 0FCC1H\r\nSETWRT equ 0053H\r\nLDIRVM equ 005CH\r\nWRTVDP equ 0047H\r\nRG1SAV equ 0F3E0H\r\nRDVDP  equ 013EH\r\nSNSMAT.a equ 0141h\r\n\r\nCHGMOD equ 005FH\r\n\r\nIMULT.a equ 3193H;HL ← DE*HL\r\nIDIV.a equ 31E6H;HL ← DE/HL\r\nIMOD.a equ 323AH;HL ← DE mod HL (DE ← DE/HL) \r\n\r\nWRTPSG  equ 0093H\r\n\r\nCSRY equ 0F3DCH\r\nCSRX equ 0F3DDH\r\n\r\nnull equ 0\r\n\r\nmacro marker.b, n\r\n last.marker: defl $\r\nendm\r\nmacro marker.e, n\r\n len.##n: defl $-last.marker\r\nendm\r\n`,\r\n    'ctrl':`include const\r\nfreeze:\r\nhalt\r\njr freeze\r\n\r\nmacro for ,lbend\r\n ; uses a\r\n ; c: breaked\r\n proc\r\n  local s,lb\r\n  lb:\r\n  call dcompr; uses a\r\n  jp nc,lbend\r\n  push HL\r\n  push de\r\n  push bc\r\n  call s\r\n  pop bc\r\n  pop de\r\n  pop HL\r\n  jp c,lbend\r\n  add HL,bc\r\n  jr lb\r\n  s:\r\n endp\r\nendm\r\n\r\nmacro repti ,n,lbend\r\n proc\r\n  local s,lb, lbend2\r\n  push bc\r\n  ld b,n\r\n  lb:\r\n  push bc\r\n  call s\r\n  pop bc\r\n  jr c,lbend2\r\n  djnz lb\r\n  lbend2:\r\n  pop bc\r\n  jp lbend \r\n  s:\r\n endp\r\nendm\r\n\r\n\r\nmacro reptb ,lbend\r\n  local s,lb\r\n inc b\r\n djnz lb\r\n jp lbend\r\n lb:\r\n  push bc\r\n  call s\r\n  pop bc\r\n  jp c,lbend\r\n djnz lb\r\n jp lbend \r\n s:\r\nendm\r\n\r\n\r\n\r\nmacro callsva,pp\r\n local sva\r\n ld (sva-1),a\r\n call pp\r\n ld a,0\r\n sva:\r\nendm\r\nbcis0:\r\n callsva bcis0.a\r\n ret\r\nbcis0.a:\r\n ld a,b\r\n and a\r\n ret nz\r\n ld a,c\r\n and a\r\n ret\r\n\r\nmacro reptbc ,lbend\r\n local s,lb\r\n call bcis0\r\n jp z,lbend \r\n lb:\r\n  push bc\r\n  call s\r\n  pop bc\r\n  jp c,lbend\r\n  dec bc\r\n  call bcis0\r\n jr nz, lb\r\n jp lbend \r\n s:\r\nendm\r\n\r\n\r\niff.NZ equ 0\r\niff.Z  equ 1\r\niff.NC equ 2\r\niff.C  equ 3\r\n\r\nmacro iff,cnd,to\r\n local iff.\r\n if iff.##cnd eq iff.NZ\r\n  jr z,to\r\n endif\r\n if iff.##cnd eq iff.Z\r\n  jr nz,to\r\n endif\r\n if iff.##cnd eq iff.NC\r\n  jr c,to\r\n endif\r\n if iff.##cnd eq iff.C\r\n  jr nc,to\r\n endif\r\n ;jr cnd, skip\r\n ;jr to\r\n ;skip:\r\nendm\r\n\r\nmacro break,cnd\r\n if NUL cnd\r\n  scf\r\n  ret\r\n else\r\n  proc \r\n   local jj\r\n   iff cnd ,jj\r\n   break\r\n  jj:\r\n  endp\r\n endif\r\nendm\r\nmacro continue,cnd\r\n if NUL cnd \r\n  or a\r\n  ret\r\n else\r\n  proc \r\n   local jj\r\n   iff cnd,jj\r\n   continue\r\n  jj:\r\n  endp\r\n endif\r\nendm\r\n\r\n\r\nmacro djnzr,reg, j\r\n dec reg\r\n jr NZ,j\r\nendm\r\n\r\nmacro callhl\r\n local LCD\r\n ld (LCD-2),HL\r\n call LCD\r\n LCD:\r\nendm\r\n\r\nmacro stride,lim,to\r\n if (low $)<lim\r\n  exitm\r\n endif\r\n ds 256+to-(low $),0cdh\r\nendm`,\r\n    'th':`include ctrl\r\ninclude sp\r\ninclude vdp\r\ninclude mem\r\ninclude math\r\ninclude debug\r\n\r\nth.ofs.stp equ 256-4\r\nth.ofs.sp equ th.ofs.stp+1\r\nth.ofs.spini equ th.ofs.stp\r\nfld.top equ th.ofs.spini-2\r\nth.st.blank equ 0c9h\r\nth.st.active equ 31h\r\n\r\n;macro th.for,lb\r\n; ld HL,th.start\r\n; ld de,th.end\r\n; ld bc,th.size\r\n; for lb\r\n;endm\r\nmacro th.for.a, nx, st, en\r\n if nul st\r\n  th.for.a nx, 0, th.count\r\n  exitm\r\n endif\r\n local do, loop\r\n ld a,st+(high th.start)\r\n loop:\r\n  cp en+(high th.start)\r\n  jp nc, nx\r\n  push af\r\n  ld h,a\r\n  ld l,0\r\n  call do\r\n  popa\r\n  jp c, nx\r\n  inc a\r\n jr loop\r\n do:\r\nendm\r\n\r\nmacro th.new.range,st,en\r\n ld bc,st\r\n ld(th.new.start),bc\r\n ld bc,en\r\n ld(th.new.end),bc\r\nendm\r\n\r\ndefsub th.isblank.a\r\n ; h= thread\r\n ; z if true\r\n ld l, th.ofs.stp\r\n ld a,(hl)\r\n cp th.st.blank\r\nendsub th.isblank.a\r\n\r\ndefsub th.new\r\n; nc for alloc fail\r\nproc \r\n local lbend\r\n db 21h\r\n th.new.start:\r\n dw th.start\r\n db 11h\r\n th.new.end:\r\n dw th.end\r\n ld bc,th.size\r\n for lbend\r\n  ; TODO th.ofs.stp\r\n  call th.isblank.a\r\n  break z\r\n  continue\r\n lbend:\r\n ret nc\r\n ; TODO th.ofs.stp\r\n ld L,th.ofs.stp\r\n ld (HL),31h\r\n inc HL\r\n ld (HL),th.ofs.spini\r\n ld a,h\r\n inc HL\r\n ld (hl),a\r\n inc HL\r\n ld (HL),0c9h\r\n ld l,th.bottom\r\n scf\r\n ret\r\nendp\r\nendsub th.new\r\n\r\ndefsub th.init\r\nproc\r\n local lbend\r\n th.for.a lbend\r\n  ; TODO th.ofs.stp\r\n  ld L, th.ofs.stp\r\n  ld (HL),th.st.blank\r\n  continue\r\n lbend:\r\n ; disable timer\r\n ld HL,0fd9fh\r\n ld (hl),0c9h\r\n call susint\r\n ret\r\nendp\r\nendsub th.init\r\n\r\ndefsub th.stepall\r\n th.for.a thnx\r\n  ;todo th.ofs.stp\r\n  ld (th.cur),hl\r\n  call th.isblank.a\r\n  continue z\r\n  call th.step\r\n  continue\r\n thnx:\r\nendsub th.stepall\r\n\r\ndefsub th.step\r\n sp2mem adrssp+1\r\n ld HL,(th.cur)\r\n ld l,th.ofs.stp\r\n ;call susint\r\n jp (hl)\r\nendsub th.step\r\n\r\ndefsub th.yield\r\n ld hl,(th.cur)\r\n ld l,th.ofs.sp\r\n sp2mem\r\n adrssp:\r\n ld sp,0\r\n jp doint\r\nendsub th.yield\r\n\r\ndefsub th.term\r\n ld hl,(th.cur)\r\n ; TODO th.ofs.stp\r\n ld L,th.ofs.stp\r\n ld (hl),th.st.blank\r\n jr adrssp\r\nendsub th.term\r\n\r\nmacro th.with.do, to\r\n local pr\r\n th.with pr\r\n jr to\r\n pr:\r\nendm\r\n\r\nmacro th.with.setdst, reg\r\n ld (th.jpdest-2),reg\r\nendm\r\nmacro th.with,pr\r\n movw (th.jpdest-2), pr\r\n call th.with.s\r\nendm\r\nmacro th.with.ret\r\n jp th.ewith\r\nendm\r\n\r\ndefsub th.with.s\r\n sp2mem th.wrssp-2\r\n ld l, th.ofs.sp\r\n ld (th.updsp-2),hl\r\n mem2sp\r\n jp 0\r\n th.jpdest:\r\nth.ewith:\r\n ld (0),sp\r\n th.updsp:\r\n ld sp,0\r\n th.wrssp:\r\nendsub th.with.s\r\n \r\n\r\n \r\n \r\ndefsub th.push\r\n ;push bc to thread hl\r\n th.with tpsbc\r\n ret\r\n tpsbc:\r\n  push bc\r\n  th.with.ret 0\r\nendsub th.push\r\n\r\n\r\ndefwork th.cur\r\n dw 0\r\nendwork th.cur\r\n\r\ndefsub th.loop\r\n ; hook before stepall\r\n db 0cdh\r\n h.thent:\r\n dw th.nop\r\n ; save prev timecnt\r\n ld a,(timecnt)\r\n push af\r\n ; Do stepall\r\n call th.stepall\r\n ; hook after stepall\r\n db 0cdh\r\n h.thlop:\r\n dw th.nop\r\n ; wait until timecnt changes\r\n pop af\r\n bwat:\r\n  ld hl,timecnt\r\n  cp (hl)\r\n  jr nz,bbwat\r\n  push af\r\n  call doint\r\n  pop af\r\n  jr bwat\r\n bbwat:\r\n ; repeat\r\n jr th.loop\r\nendsub th.loop\r\n\r\nth.nop:\r\n ret\r\n\r\n\r\nmacro th.pushi, val\r\n ld bc,val\r\n call th.push\r\nendm\r\n\r\n`,\r\n    'sub':``,\r\n    'debug':`include math\r\n;debug\r\nmacro show,reg\r\n ld (hexval+1),reg\r\n call showhex\r\nendm\r\nmacro showm ,ad\r\n push hl\r\n ld HL,(ad)\r\n show HL\r\n pop HL\r\nendm\r\nmacro showlb,lb\r\n push hl\r\n ld hl,lb\r\n ld (hexval+1),hl\r\n call showhex\r\n pop hl\r\nendm\r\nshowhex:\r\nproc\r\n local loop\r\n push af\r\n push bc\r\n push HL\r\n hexval:\r\n ld hl,0\r\n ld b,4\r\n loop:\r\n  xor a\r\n  rept 4\r\n   slhl\r\n   rla\r\n  endm\r\n  call showhex1\r\n djnz loop\r\n ld a,32\r\n call wrt\r\n pop HL\r\n pop bc\r\n pop af\r\n ret\r\nendp\r\nshowhex1:\r\nproc\r\n local els\r\n cp 10\r\n jp nc, els\r\n add a,48\r\n jp wrt\r\n els:\r\n add a,65-10\r\n jp wrt\r\nendp\r\nabort:\r\n call wrt\r\n db 018h,0feh\r\nret\r\n\r\nmacro trace,v\r\n if not nul v\r\n  push af\r\n  ld a,v\r\n  ld (trad),a\r\n  pop af\r\n endif\r\n call trace.s\r\nendm\r\ntrace.s:\r\n push af\r\n push hl\r\n ld a,(trad)\r\n ld hl,1ae0h\r\n call wrt\r\n call 4dh\r\n inc a\r\n ld (trad),a\r\n ld a,32\r\n call wrt \r\n pop hl\r\n pop af\r\n ret\r\ntrad:\r\n db 65\r\n\r\nshowz:\r\n push af\r\n jr z,showz.s\r\n ld a,\"N\"\r\n call wrt\r\n showz.s:\r\n ld a,\"Z\"\r\n call wrt\r\n ld a,32\r\n call wrt\r\n pop af\r\n ret\r\n \r\n\r\nshowc:\r\n push af\r\n jr c,showc.s\r\n ld a,\"N\"\r\n call wrt\r\n showc.s:\r\n ld a,\"C\"\r\n call wrt\r\n ld a,32\r\n call wrt\r\n pop af\r\n ret\r\n \r\n\r\n\r\n\r\n\r\n\r\nmacro unreach, mesg\r\n trace mesg\r\n dw 0x18,0xfe\r\nendm\r\nmacro head, lb\r\n unreach lb\r\n marker.b lb\r\n lb:\r\nendm\r\n\r\nmacro defsub, n\r\n head n\r\nendm\r\nmacro endsub, n\r\n ret\r\n marker.e n\r\nendm\r\nmacro defwork, n\r\n head n\r\nendm\r\nmacro endwork, n\r\n marker.e n\r\nendm\r\n\r\ndefsub wrt\r\nproc\r\n local sk\r\n push hl\r\n push af\r\n ld hl,1800h\r\n cursor:\r\n call 4dh\r\n inc hl\r\n ld a,h\r\n cp 1bh\r\n jr c,sk\r\n  ld h,18h\r\n sk:\r\n ld (cursor-2),hl\r\n pop af\r\n pop hl\r\n ret\r\nendp\r\nendsub wrt\r\n`,\r\n    'sp':`include mem\r\ninclude debug\r\nmacro sp.get\r\n ld HL,0\r\n ADD hl, sp\r\nendm\r\nmacro sp.set\r\n ld sp,hl\r\nendm\r\nmacro mem2sp,ad\r\n local rs\r\n if nul ad\r\n  ld (rs-2),hl\r\n  ld sp,(0)\r\n  rs:\r\n else\r\n  ld sp,(ad)\r\n endif\r\nendm\r\nmacro sp2mem,ad\r\n local spad\r\n if nul ad\r\n  ld (spad-2),hl\r\n  ld (0),sp\r\n  spad:\r\n else\r\n  ld (ad),sp\r\n endif\r\nendm\r\n\r\nmacro showsp\r\n ld (sptmp),sp\r\n showm sptmp\r\nendm\r\nsptmp:\r\ndw 0\r\nmacro showstk\r\n showsp\r\n ld (sva),a\r\n ld a,\":\"\r\n call wrt\r\n ld a,(sva)\r\n ex (sp),hl\r\n show hl\r\n ex (sp),hl\r\nendm\r\nsva: db 0`,\r\n    'oop':`include mem\r\ninclude th\r\ninclude assert\r\n\r\n;a2 a1  oldpc oldix lcl1 lcl2\r\nargidx equ 2\r\nmacro getarg ,n\r\n ld l,(ix+argidx+n*2)\r\n ld h,(ix+argidx+n*2+1)\r\nendm\r\n\r\nmacro setlcl ,n\r\n ld (IX-(n*2-1)),h\r\n ld (ix-n*2),l\r\nendm\r\n\r\nmacro getlcl ,n\r\n ld h,(IX-(n*2-1))\r\n ld l,(ix-n*2)\r\nendm\r\n\r\nmacro addarg\r\n push hl\r\n; hl=arg  stktp=af\r\n;ex (sp),hl\r\n;ld a,h\r\n;push af\r\nendm\r\n\r\n\r\n\r\nmacro pusharg ,n\r\n getarg n\r\n push HL\r\nendm\r\n\r\nmacro pushlcl ,n\r\n getlcl n\r\n push HL\r\nendm\r\n\r\nmacro enter ,locals\r\n push ix\r\n ld ix,0\r\n add ix,sp\r\n rept locals\r\n  push HL\r\n endm\r\nendm\r\n\r\nmacro pops ,n\r\n rept n*2\r\n  inc sp\r\n endm\r\nendm\r\n\r\n\r\nmacro exit,n\r\n ld sp,ix\r\n pop ix\r\n if n!=0\r\n  exx\r\n  pop bc\r\n  pops n\r\n  push bc\r\n  exx\r\n endif\r\n ret\r\nendm\r\n\r\nmacro pushthis\r\n getthis\r\n push af\r\nendm\r\nmacro popthis\r\n popa\r\n ld (this),a\r\nendm\r\n\r\n\r\nmacro invoketg.a,fld,args\r\n; pushthis before arg push\r\n; hl=target \r\n ld a,h\r\n ld (this),a\r\n getfld fld\r\n callhl\r\n; pops args\r\n; popthis after \r\nendm\r\n\r\nmacro invoke,fld\r\n getfld fld\r\n callhl\r\n; pops args\r\n getthis\r\nendm\r\n\r\nmacro getfld, n\r\n local ad\r\n ld (ad-1),a\r\n ld hl,(n)\r\n ad:\r\nendm\r\n\r\nmacro setfld, n\r\n local ad\r\n ld (ad-1),a\r\n ld (n),hl\r\n ad:\r\nendm\r\n\r\nmacro getfldtg,n\r\n;hl=tg\r\n ld l,n\r\n peekw hl,hl\r\nendm\r\n\r\nmacro setfldtg,n\r\n; stk=val hl=tg\r\n ld l,n\r\n pop de\r\n pokew hl,de\r\nendm\r\n\r\nmacro getfldtg, n\r\n; hl=target\r\n ld d,h\r\n ld e,n\r\n peekw HL,de\r\nendm\r\n\r\nmacro tgconst,n\r\n ld (n-1),a\r\nendm\r\nmacro tgconst.g ,r16,n,fld\r\n ld r16,(fld)\r\n n:\r\nendm\r\nmacro tgconst.s ,n,fld,r16\r\n ld (fld),r16\r\n n:\r\nendm\r\n\r\n\r\nmacro curth2this\r\n ld a,(th.cur+1)\r\n ld (this),a\r\nendm\r\nmacro getthis\r\n ld a,(this)\r\nendm\r\n\r\nmacro new,Class,flds,st,en\r\n if nul st\r\n  th.new.range th.start, th.end\r\n else\r\n  th.new.range th.start+st*th.size, th.start+en*th.size\r\n endif\r\n pushi flds, bc\r\n pushi Class, bc\r\n call o.new\r\nendm\r\n\r\ndefsub o.new\r\nproc\r\n local retad,svthis,svsp,loop,lpend, w,allocfail,finally,lp2,lp2end\r\n ; {val .f} n &initbl retad\r\n pop hl;retad\r\n ld (retad-2),hl\r\n ; set initbl for th.with\r\n pop hl;&initbl\r\n th.with.setdst hl\r\n ; save this\r\n ld (svthis-1),a\r\n ; allocate thread\r\n call th.new\r\n jr nc, allocfail\r\n push hl; thread address\r\n call th.with.s; call &initbl\r\n pop hl; thread address\r\n ld a,h; set this as thread\r\n ; init fields\r\n pop bc; n of {val .f}\r\n inc c\r\n loop:\r\n  dec c\r\n  jr z,lpend\r\n  pop hl; .f\r\n  ld h,a\r\n  ld (w-2),hl\r\n  pop hl; val\r\n  ld (w),hl\r\n  w:\r\n jr loop\r\n lpend:\r\n ; return h as this\r\n ld h,a\r\n finally:\r\n  ;restore a before call o.new\r\n  ld a,0\r\n  svthis:\r\n  ;return \r\n  jp 0\r\n  retad:\r\n allocfail:\r\n  ; drop {val .f}\r\n  pop bc; n of {val .f}\r\n  ld b,c\r\n  inc c\r\n  lp2:\r\n   dec c\r\n   jr z, lp2end\r\n   pop hl\r\n   pop hl\r\n  jr lp2\r\n  lp2end:\r\n  ld hl,null;  todo null\r\n  jr finally\r\nendp\r\nendsub o.new\r\n\r\nmacro new.arg, n, v\r\n if not nul v\r\n  ld hl,v\r\n endif\r\n push hl\r\n pushi n,bc\r\nendm\r\n \r\nmacro o.assert.eq,fld, v\r\n local aa\r\n assert.do aa\r\n  getfld fld\r\n  assert.eq v\r\n  ret\r\n aa:\r\nendm\r\n\r\nthis:\r\ndb 0\r\n\r\nmacro fld.def,n\r\n n equ fldidx\r\n fldidx:defl fldidx-2\r\nendm\r\nmacro class,Class,super\r\n unreach \"c\"\r\n marker.b 0\r\n dw super\r\n fldidx:defl fld.top; todo fld.top\r\n Class:\r\n  fld .class,Class\r\nendm\r\nmacro fld.bottom,Class\r\n if defined Class##.bottom \r\n  if Class##.bottom ne fldidx\r\n   .error bottom ne fldidx\r\n  endif\r\n else\r\n Class##.bottom:defl fldidx\r\n endif\r\nendm \r\nmacro fld,n,v\r\n if defined n\r\n  if n ne fldidx\r\n   .error n ne fldidx\r\n  else \r\n   fldidx:defl fldidx-2\r\n  endif\r\n else\r\n  fld.def n\r\n endif\r\n pushi v,bc\r\nendm\r\nmacro unuse\r\n fldidx:defl fldidx-2\r\n pushi 0,bc\r\nendm\r\nmacro meth,Class,n\r\n fld .##n, Class##.##n\r\nendm\r\nmacro met2,Class,n\r\n fld n, Class##n\r\nendm\r\n\r\nclass Object,null\r\n fld .main,null\r\n fld.bottom Object\r\n marker.e Object\r\n\r\n\r\ndefsub o.boot\r\n curth2this\r\n invoke .main,0\r\nendsub o.boot\r\n\r\n\r\nmacro yield\r\n pushthis\r\n push ix\r\n call th.yield\r\n pop ix\r\n popthis\r\nendm\r\n\r\nmacro def,n,args,lcls\r\nhead n\r\n def.args:defl args\r\n def.locals:defl lcls\r\n if args>0 or lcls>0\r\n  enter lcls\r\n endif\r\nendm\r\nmacro enddef,n\r\n if def.args>0 or def.locals>0\r\n  exit def.args\r\n else\r\n  ret\r\n endif\r\n marker.e n\r\nendm\r\n\r\ndefsub isobj.a\r\n ;hl=obj?\r\n ;cy=true\r\n ld a,h\r\n cp high th.start\r\n jr c,notobj\r\n cp high th.end\r\n jr nc,notobj\r\n scf\r\n ret\r\n notobj:\r\n and a\r\nendsub isobj.a\r\n\r\ndefsub instanceof\r\n ; a=this de=Class\r\n ; z: true\r\n getfld .class\r\n jp is.subclass.a\r\nendsub instanceof\r\n\r\ndefsub get.superclass\r\n ; hl=Class\r\n dec hl\r\n dec hl\r\n peekw hl,hl\r\nendsub get.superclass\r\n\r\ndefsub is.subclass.a\r\nproc \r\n local top\r\n ; hl=Subclass\r\n ; de=Superclass\r\n ; z:true\r\n top:\r\n cpde.a 0\r\n ret z\r\n call get.superclass\r\n push de\r\n ld de,null\r\n cpde.a 0\r\n pop de\r\n jr nz,top\r\n cpde.a 0\r\nendp\r\nendsub is.subclass.a\r\n `,\r\n    'spr':`include const\r\ninclude th\r\ninclude mem\r\ninclude oop\r\ninclude sub\r\n\r\nclass Sprite,Object\r\n fld .main, 0\r\n fld.bottom Object\r\n fld .x, 100\r\n fld .y, 100\r\n fld .p, 0\r\n fld .c, 2\r\n fld.bottom Sprite\r\n marker.e Sprite\r\n \r\nmacro outwrt\r\n  out (98h),a\r\nendm\r\n\r\n\r\nmacro spr.unscale\r\n ; HL -> A\r\n rept spr.scale\r\n  srlhl\r\n endm\r\n LD A,L\r\n sub 8 \r\nendm\r\n\r\ndefsub spr.puts\r\nproc\r\n local t1,t2,t3,t4\r\n ld hl, 1b00h\r\n call SETWRT\r\n th.for.a sprl\r\n  ld a,h\r\n  tgconst t1\r\n  tgconst t2\r\n  tgconst t3\r\n  tgconst t4\r\n\r\n  tgconst.g hl,t1,.y \r\n  spr.unscale 0\r\n  outwrt 0\r\n  \r\n  tgconst.g hl,t2,.x \r\n  spr.unscale 0\r\n  outwrt 0\r\n  \r\n  tgconst.g a,t3,.p \r\n  sla a\r\n  sla a\r\n  outwrt 0\r\n  \r\n  tgconst.g a,t4,.c \r\n  outwrt 0\r\n  continue\r\n sprl:\r\nendp\r\nendsub spr.puts\r\n \r\n `,\r\n    'sprpat':`include const\r\n\r\n;aaa\r\nspr.inipat:\r\n ld de,3800h\r\n ld hl,spr.pat\r\n ld bc,128\r\n jp LDIRVM\r\nbg.inipat:\r\n ret\r\nspr.pat:\r\n; --- Slot 0 cat fstand\r\n; color 9\r\nDB $0C,$0E,$0F,$4F,$3D,$1D,$7F,$1B\r\nDB $0C,$3F,$7F,$7F,$6F,$0F,$06,$0C\r\nDB $18,$38,$F8,$F9,$DE,$DC,$7F,$6C\r\nDB $98,$FC,$FE,$FE,$F6,$F0,$60,$70\r\n; \r\n; --- Slot 1 cat fwalk1\r\n; color 9\r\nDB $0C,$0E,$0F,$4F,$3D,$1D,$7F,$1B\r\nDB $0C,$3F,$7F,$7F,$EF,$EF,$06,$06\r\nDB $18,$38,$F8,$F9,$DE,$DC,$7F,$6C\r\nDB $98,$FC,$FE,$FE,$D4,$78,$F0,$00\r\n; \r\n; --- Slot 2 cat fwalk2\r\n; color 9\r\nDB $18,$1C,$1F,$9F,$7B,$3B,$FE,$36\r\nDB $19,$3F,$7F,$7F,$2B,$1E,$0F,$00\r\nDB $30,$70,$F0,$F2,$BC,$B8,$FE,$D8\r\nDB $30,$FC,$FE,$FE,$F7,$F7,$60,$60\r\n; \r\n; --- Slot 3 cat omg\r\n; color 9\r\nDB $2C,$8E,$0F,$4B,$3D,$11,$7F,$1D\r\nDB $CA,$FF,$7F,$3F,$15,$1F,$0E,$00\r\nDB $1C,$39,$F8,$E9,$DE,$C4,$7F,$5C\r\nDB $AB,$FF,$FF,$FE,$AC,$F8,$70,$00\r\n\r\nds 60*32\r\n`,\r\n    'tnu':`\r\ninclude spr\r\ninclude bool\r\ninclude key\r\n\r\n;.onUpdate equ .c-2\r\n;.update equ .onUpdate-2\r\n;.screenOut equ .update-2\r\n;.die equ .screenOut-2\r\n;.updateEx equ .die-2\r\n\r\nmacro end.const, n\r\n pushi RActor.wait,bc\r\n pushi o.boot,bc\r\n th.with.ret 0 \r\n marker.e n\r\nendm\r\n\r\nmacro RActor.noovr,Class\r\n meth Class,main\r\n fld.bottom Object\r\n fld .x, 0\r\n fld .y, -1024\r\n fld .p, 0\r\n fld .c, 3\r\n fld.bottom Sprite\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut \r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld.bottom RActor\r\nendm\r\n\r\nclass RActor,Sprite\r\n RActor.noovr RActor\r\n end.const RActor\r\nRActor.main:\r\n enter 0\r\n exit 0\r\nRActor.update:\r\n invoke .onUpdate\r\n yield\r\n ret \r\nRActor.onUpdate:\r\n ret\r\nRActor.screenOut:\r\nproc\r\n local true\r\n getfld .x\r\n bit 1,h\r\n jr nz, true\r\n getfld .y\r\n ld de,192*2\r\n cpde.a\r\n getthis\r\n jr nc,true\r\n ld hl,0\r\n xor a\r\n ret\r\n true:\r\n ld hl,1\r\n scf\r\n ret\r\nendp\r\nRActor.wait:\r\nproc\r\n local lbl\r\n lbl:\r\n invoke .update\r\n jr lbl\r\nendp\r\ndef RActor.die,0,0\r\n ld h,a\r\n ld l,th.ofs.stp\r\n ld (hl),th.st.blank\r\n ld hl, 0\r\n setfld .c\r\nenddef RActor.die\r\n\r\ndef RActor.updateEx,1,0\r\nproc \r\n local n\r\n; enter 0\r\n getarg 1\r\n ld b,h\r\n ld c,l\r\n reptbc n\r\n  invoke .update\r\n  continue\r\n n:\r\nendp\r\nenddef RActor.updateEx\r\n\r\ncrashTo.size equ 8<<spr.scale\r\n\r\nproc\r\n local gx,gy,t1,t2\r\n local endc,cr1\r\n local fe\r\n\r\ndefsub crashTo.setXY\r\n getfld .x\r\n const gx,hl\r\n getfld .y\r\n const gy,hl\r\nendsub crashTo.setXY\r\n\r\n\r\ndef RActor.crashTo,1,0\r\n call crashTo.setXY\r\n getarg 1\r\n const cr.class,hl\r\n call isobj.a\r\n jr c, cr1\r\n  ld hl, th.start\r\n  ld de, th.end\r\n  call crashTo1\r\n  jr endc\r\n cr1:\r\n  getthis 0\r\n  call crashTo1\r\n  flagtobool c\r\n endc:\r\nenddef RActor.crashTo\r\n\r\nmacro crashToClass,Class,st,en\r\n ; a=this\r\n call crashTo.setXY\r\n ld hl,Class\r\n const cr.class,hl\r\n ld hl,th.start+st*th.size\r\n ld de,th.start+en*th.size\r\n call crashToC\r\nendm\r\n\r\nmacro foreach.a, Class,st,en,nxt\r\n th.for.a nxt, st, en\r\n  all.skip Class\r\nendm\r\n\r\n\r\nmacro all.skip.blank.self\r\n ; skip blank\r\n  ; TODO th.ofs.stp\r\n  call th.isblank.a\r\n  continue z\r\n  ; skip hl==this\r\n  getthis 0\r\n  cp h\r\n  continue z\r\nendm\r\nmacro all.skip.isnot,Class\r\n  ; skip object not instance of *Class*\r\n  push hl\r\n  ld a,h\r\n  ld de,Class\r\n  call instanceof\r\n  getthis 0\r\n  pop hl\r\n  continue nz\r\nendm\r\nmacro all.skip, Class\r\n all.skip.blank.self 0\r\n all.skip.isnot Class\r\nendm\r\n\r\ndefsub crashToC\r\n ;before:\r\n ; call crashTo.setXY\r\n ; const cr.class,Class\r\n ; hl start\r\n ; de end\r\n ld bc,th.size\r\n for fe\r\n  all.skip.blank.self 0\r\n  ; skip object not instance of *Class*\r\n  push hl\r\n  ld a,h\r\n  ldconst de,cr.class\r\n  call instanceof\r\n  pop hl\r\n  continue nz\r\n  ; do crashTo1\r\n  getthis 0\r\n  call crashTo1\r\n  break c\r\n  continue\r\n fe:\r\n getthis 0\r\n ret c\r\n ld hl,null\r\nendsub crashToC\r\n\r\ndefsub crashTo1\r\n ;hl=tg\r\n ;cy:true\r\n ;hl is used\r\n push af\r\n ld a,h\r\n tgconst t1\r\n tgconst t2\r\n pop af\r\n tgconst.g hl,t1,.x\r\n ldconst bc,gx\r\n subhl bc\r\n call abs\r\n ld bc,crashTo.size\r\n subhl bc\r\n ret nc\r\n\r\n tgconst.g hl,t2,.y\r\n ldconst bc,gy\r\n subhl bc\r\n call abs\r\n ld bc,crashTo.size\r\n subhl bc\r\nendsub crashTo1\r\n\r\nendp\r\n\r\n\r\nmacro tnu.run,Main\r\n ld sp,sp.ini\r\n call screen2\r\n \r\n showsp\r\n showlb endusr\r\n call spr.inipat\r\n call bg.inipat\r\n\r\n ld hl,th.start\r\n ld (hl),0cdh\r\n ld de,th.start+1\r\n ld bc,th.size*th.count-1\r\n ldir\r\n \r\n call th.init\r\n ;call mus.ini\r\n new Main, 0\r\n movw (h.thlop),spr.puts\r\n movw (h.thent),keyall\r\n jp th.loop\r\nendm\r\n\r\n;aaaa`,\r\n    'key':`include debug\r\n\r\ndefsub keyall\r\nproc\r\n;show hl\r\n local lp\r\n ld hl,keymat1\r\n ld de,keymat2\r\n ld bc,11\r\n ldir\r\n ld a,0\r\n ld hl,keymat1\r\n lp:\r\n push af\r\n call SNSMAT.a\r\n xor 255\r\n ld (hl),a\r\n pop af\r\n inc hl\r\n inc a\r\n cp 11\r\n jr c,lp\r\nendp\r\nendsub keyall\r\n\r\ndefwork keymat1\r\nds 11\r\nendwork keymat1\r\ndefwork keymat2\r\nds 11\r\nendwork keymat2\r\n\r\n\r\nproc\r\ndefsub getkey.a\r\nlocal chkmat\r\nex de,hl\r\nld hl,keymat1\r\ncall chkmat\r\nld hl,0\r\nret z\r\nld hl,keymat2\r\ncall chkmat\r\nld hl,1\r\nret z\r\ninc hl\r\nendsub getkey.a\r\n\r\ndefsub chkmat\r\npush de\r\nld a,d\r\nld d,0\r\nadd hl,de\r\nand (hl)\r\npop de\r\nendsub chkmat\r\n\r\ndefsub getkey\r\npush af\r\ncall getkey.a\r\npop af\r\nendsub getkey\r\n\r\nendp`,\r\n    'map':`include sub\r\ninclude math\r\ninclude tnu\r\n\r\ndefsub map.adr\r\n ; hl=chipx\r\n ; de=chipy\r\n rept 5\r\n  slde 0\r\n endm\r\n add hl,de\r\n ld de,1800h\r\n add hl,de\r\nendsub map.adr\r\n\r\ndefsub map.set.a\r\n ;  a=data\r\n call map.adr\r\n call 4dh\r\nendsub map.set.a\r\n\r\ndefsub map.get.a\r\n call map.adr\r\n call 4ah \r\nendsub map.get.a\r\n\r\ndefsub map.adrat.a\r\n ; hl=spr_x\r\n ; de=spr_y\r\n spr.unscale 0\r\n srl a\r\n srl a\r\n srl a\r\n push af\r\n ex de,hl\r\n spr.unscale 0\r\n srl a\r\n srl a\r\n srl a\r\n ld d,0\r\n ld e,a\r\n pop hl\r\n ld l,h\r\n ld h,0\r\n inc hl\r\n inc de\r\n call map.adr\r\nendsub map.adrat.a\r\n\r\ndefsub map.getat.a\r\n call map.adrat.a\r\n call 4ah\r\nendsub map.getat.a\r\n\r\ndefsub map.setat.a\r\n ; a=data\r\n push af\r\n call map.adrat.a\r\n pop af\r\n call 4dh\r\nendsub map.setat.a\r\n\r\ndefsub locate\r\n ; hl=chipx\r\n ; de=chipy\r\n call map.adr\r\n ld (cursor-2),hl\r\nendsub locate\r\n`,\r\n    'maze':``,\r\n    't1':`org 09000h\r\njp main\r\ninclude const\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude tnu\r\ninclude sp\r\n\r\n;===your code \r\n\r\nright:dw 0\r\n\r\nmain:\r\ntnu.run Main\r\ndef Main.main,0,0\r\nnew.arg .vx,1\r\nnew.arg .vy,0\r\nnew.arg .x,0\r\nnew.arg .y,100\r\nnew Cat,4\r\n\r\nnew.arg .x,100\r\nnew.arg .y,100\r\nnew Target,2\r\n\r\nld (right),hl\r\nld a,h\r\nld de,RActor\r\ncall instanceof\r\ncall showz\r\n\r\nld a,(right+1)\r\nld de,Target\r\ncall instanceof\r\ncall showz\r\n\r\nld a,(right+1)\r\nld de,Cat\r\ncall instanceof\r\ncall showz\r\n\r\n\r\nld hl,1\r\nsetfld .c\r\nenddef 0\r\n\r\nclass Main,RActor\r\n RActor.noovr Main\r\n end.const Main\r\nclass Target,RActor\r\n RActor.noovr Target\r\n met2 Target,.push\r\n end.const Target\r\ndef Target.main,0,0\r\nenddef\r\nclass Cat,RActor\r\n RActor.noovr Cat\r\n fld .vy, 0\r\n fld .vx, 0\r\n fld.bottom Cat\r\n end.const Cat\r\ndef Cat.main,0,0\r\n blp:\r\n  ld hl,0108h\r\n  call getkey\r\n  jpf nomov\r\n  getthis\r\n  ;x+=vx\r\n  getfld .x\r\n  ex de, hl\r\n  getfld .vx\r\n  add hl,de\r\n  setfld .x\r\n  nomov:\r\n  ; y+=vy\r\n  getfld .y\r\n  ex de, hl\r\n  getfld .vy\r\n  add hl,de\r\n  setfld .y\r\n  ld hl,(right)\r\n  push hl\r\n  invoke .crashTo\r\n  jpf cr\r\n   ; r.x+=10\r\n   ld hl,(right)\r\n   getfldtg .x\r\n   ld de,10\r\n   add hl,de\r\n   push hl\r\n   ld hl,(right)\r\n   setfldtg .x\r\n   ; r.push()\r\n   pushthis 0\r\n   ld hl,(right)\r\n   invoketg.a .push\r\n   popthis 0\r\n  cr:\r\n  invoke .update\r\n jp blp\r\nenddef\r\n; test t1\r\ndef Target.push,0,0\r\n ld hl,3\r\n setfld .p\r\n repti 30,pse\r\n  getfld .x\r\n  inc hl\r\n  setfld .x\r\n  invoke .update\r\n  continue\r\n pse:\r\n ld hl,0\r\n setfld .p\r\nenddef\r\n\r\nendusr: \r\ninclude sprpat\r\n\r\nend main\r\nhttps://msxpen.com/codes/-N6DDfMvZq9aUeJ9JLpN\r\nhttps://msxpen.com/codes/-N6QGYk-rr5iDuTtHpF7`,\r\n    't2':`org 08000h\r\ninclude tnu\r\ninclude bool\r\ninclude map\r\n\r\nmain:\r\ntnu.run Main\r\n;range 0-5\r\nclass EBullet,RActor\r\n meth EBullet,main\r\n fld .x,0\r\n fld .y,0\r\n fld .p,0\r\n fld .c,0\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut\r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld .vx,0\r\n fld .vy,0\r\n end.const 0\r\ndef EBullet.main,0,0\r\n ;p=7;\r\n ld hl,7\r\n setfld .p\r\n ;c=15;\r\n ld hl,15\r\n setfld .c\r\n lb1:\r\n ld hl,true\r\n jpf lb2\r\n ;x+=vx;\r\n getfld .vx\r\n push hl\r\n getfld .x\r\n pop de\r\n add hl, de\r\n setfld .x\r\n ;y+=vy;\r\n getfld .vy\r\n push hl\r\n getfld .y\r\n pop de\r\n add hl, de\r\n setfld .y\r\n invoke .screenOut\r\n jpf lb4\r\n ;die();\r\n invoke .die\r\n jp lb3\r\n lb4:\r\n lb3:\r\n ;update();\r\n invoke .update\r\n jp lb1\r\n lb2:\r\n ret\r\n;range 5-15\r\nclass Enemy,RActor\r\n meth Enemy,main\r\n fld .x,0\r\n fld .y,0\r\n fld .p,0\r\n fld .c,0\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut\r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld .vx,0\r\n fld .bvx,0\r\n fld .bvy,0\r\n fld .bdist,0\r\n meth Enemy,fire\r\n end.const 0\r\ndef Enemy.main,0,0\r\n lb5:\r\n ld hl,200\r\n push hl\r\n getfld .y\r\n pop de\r\n call hlltde\r\n jpf lb6\r\n ;y+=2;\r\n ld hl,2\r\n push hl\r\n getfld .y\r\n pop de\r\n add hl, de\r\n setfld .y\r\n ;update();\r\n invoke .update\r\n jp lb5\r\n lb6:\r\n ld hl,(gbl_player)\r\n getfldtg .x\r\n push hl\r\n getfld .x\r\n pop de\r\n call hlgtde\r\n jpf lb8\r\n ;vx=0-2;\r\n ld hl,2\r\n push hl\r\n ld hl,0\r\n pop de\r\n subhl de\r\n setfld .vx\r\n jp lb7\r\n lb8:\r\n ;vx=2;\r\n ld hl,2\r\n setfld .vx\r\n lb7:\r\n ;fire();\r\n invoke .fire\r\n lb9:\r\n ld hl,true\r\n jpf lb10\r\n invoke .screenOut\r\n jpf lb12\r\n ;die();\r\n invoke .die\r\n jp lb11\r\n lb12:\r\n lb11:\r\n ;y+=2;\r\n ld hl,2\r\n push hl\r\n getfld .y\r\n pop de\r\n add hl, de\r\n setfld .y\r\n ;x+=vx;\r\n getfld .vx\r\n push hl\r\n getfld .x\r\n pop de\r\n add hl, de\r\n setfld .x\r\n ;update();\r\n invoke .update\r\n jp lb9\r\n lb10:\r\n ret\r\ndef Enemy.fire,0,0\r\n ;bvx=$player.x-x;\r\n getfld .x\r\n push hl\r\n ld hl,(gbl_player)\r\n getfldtg .x\r\n pop de\r\n subhl de\r\n setfld .bvx\r\n ;bvy=$player.y-y;\r\n getfld .y\r\n push hl\r\n ld hl,(gbl_player)\r\n getfldtg .y\r\n pop de\r\n subhl de\r\n setfld .bvy\r\n ;bdist=abs(bvx)+abs(bvy);\r\n getfld .bvy\r\n call abs\r\n push hl\r\n getfld .bvx\r\n call abs\r\n pop de\r\n add hl, de\r\n setfld .bdist\r\n ;bdist/=8;\r\n pushthis\r\n getfld .bdist\r\n push hl\r\n ld hl,8\r\n pop de\r\n call IDIV.a\r\n popthis\r\n setfld .bdist\r\n ;bvx/=bdist;\r\n pushthis\r\n getfld .bvx\r\n push hl\r\n getfld .bdist\r\n pop de\r\n call IDIV.a\r\n popthis\r\n setfld .bvx\r\n ;bvy/=bdist;\r\n pushthis\r\n getfld .bvy\r\n push hl\r\n getfld .bdist\r\n pop de\r\n call IDIV.a\r\n popthis\r\n setfld .bvy\r\n ;new EBullet{        x,y,vx:bvx,vy:bvy    };\r\n getfld .x\r\n new.arg .x\r\n getfld .y\r\n new.arg .y\r\n getfld .bvx\r\n new.arg .vx\r\n getfld .bvy\r\n new.arg .vy\r\n new EBullet,4,0,5\r\n ret\r\n;range 0-5\r\nclass Main,RActor\r\n meth Main,main\r\n fld .x,0\r\n fld .y,0\r\n fld .p,0\r\n fld .c,0\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut\r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld .i,0\r\n end.const 0\r\ndef Main.main,0,0\r\n ;$player=new Player{x:256, y: 300, p:$pat_spr+4, c:15};\r\n ld hl,256\r\n new.arg .x\r\n ld hl,300\r\n new.arg .y\r\n ld hl,4\r\n push hl\r\n ld hl,(gbl_pat_spr)\r\n pop de\r\n add hl, de\r\n new.arg .p\r\n ld hl,15\r\n new.arg .c\r\n new Player,4,0,5\r\n ld (gbl_player),hl\r\n ld hl,0\r\n setfld .i\r\n lb13:\r\n ld hl,20\r\n push hl\r\n getfld .i\r\n pop de\r\n call hlltde\r\n jpf lb14\r\n ;new Enemy{x:rnd(512), y:0, p:5, c:7};\r\n ld hl,512\r\n call rnd\r\n new.arg .x\r\n ld hl,0\r\n new.arg .y\r\n ld hl,5\r\n new.arg .p\r\n ld hl,7\r\n new.arg .c\r\n new Enemy,4,5,15\r\n ;updateEx(30);\r\n ld hl,30\r\n push hl\r\n invoke .updateEx\r\n jp lb13\r\n lb14:\r\n ret\r\n;range 15-20\r\nclass PBullet,RActor\r\n meth PBullet,main\r\n fld .x,0\r\n fld .y,0\r\n fld .p,0\r\n fld .c,0\r\n meth PBullet,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut\r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld .e,0\r\n end.const 0\r\ndef PBullet.main,0,0\r\n ;p=6;\r\n ld hl,6\r\n setfld .p\r\n ;c=8;\r\n ld hl,8\r\n setfld .c\r\n lb15:\r\n ld hl,true\r\n jpf lb16\r\n invoke .screenOut\r\n jpf lb18\r\n ;die();\r\n invoke .die\r\n jp lb17\r\n lb18:\r\n lb17:\r\n ;y-=6;\r\n ld hl,6\r\n push hl\r\n getfld .y\r\n pop de\r\n subhl de\r\n setfld .y\r\n crashToClass Enemy, 5, 15\r\n setfld .e\r\n getfld .e\r\n jpf lb20\r\n ;e.die();\r\n pushthis 0\r\n getfld .e\r\n invoketg.a .die\r\n popthis 0\r\n ;die();\r\n invoke .die\r\n jp lb19\r\n lb20:\r\n lb19:\r\n ;update();\r\n invoke .update\r\n jp lb15\r\n lb16:\r\n ret\r\ndef PBullet.onUpdate,0,0\r\n ;c+=1;\r\n ld hl,1\r\n push hl\r\n getfld .c\r\n pop de\r\n add hl, de\r\n setfld .c\r\n ld hl,14\r\n push hl\r\n getfld .c\r\n pop de\r\n call hlgtde\r\n jpf lb22\r\n ;c=0;\r\n ld hl,0\r\n setfld .c\r\n jp lb21\r\n lb22:\r\n lb21:\r\n ret\r\n;range 0-5\r\nclass Player,RActor\r\n meth Player,main\r\n fld .x,0\r\n fld .y,0\r\n fld .p,0\r\n fld .c,0\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut\r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n end.const 0\r\ndef Player.main,0,0\r\n lb23:\r\n ld hl,3\r\n ld de,10\r\n call locate\r\n getfld .y\r\n ld a,l\r\n call wrt\r\n ld a,h\r\n call wrt\r\n getthis 0\r\n \r\n ex de,hl\r\n getfld .x\r\n ld a,35\r\n call map.setat.a\r\n getthis 0\r\n ld hl,true\r\n jpf lb24\r\n ld hl, 4104\r\n call getkey\r\n jpf lb26\r\n ;x-=3;\r\n ld hl,3\r\n push hl\r\n getfld .x\r\n pop de\r\n subhl de\r\n setfld .x\r\n jp lb25\r\n lb26:\r\n lb25:\r\n ld hl, 32776\r\n call getkey\r\n jpf lb28\r\n ;x+=3;\r\n ld hl,3\r\n push hl\r\n getfld .x\r\n pop de\r\n add hl, de\r\n setfld .x\r\n jp lb27\r\n lb28:\r\n lb27:\r\n ld hl, 8200\r\n call getkey\r\n jpf lb30\r\n ;y-=3;\r\n ld hl,3\r\n push hl\r\n getfld .y\r\n pop de\r\n subhl de\r\n setfld .y\r\n jp lb29\r\n lb30:\r\n lb29:\r\n ld hl, 16392\r\n call getkey\r\n jpf lb32\r\n ;y+=3;\r\n ld hl,3\r\n push hl\r\n getfld .y\r\n pop de\r\n add hl, de\r\n setfld .y\r\n jp lb31\r\n lb32:\r\n lb31:\r\n crashToClass Enemy, 5, 15\r\n jpf lb34\r\n ;die();\r\n invoke .die\r\n jp lb33\r\n lb34:\r\n lb33:\r\n crashToClass EBullet, 0, 5\r\n jpf lb36\r\n ;die();\r\n invoke .die\r\n jp lb35\r\n lb36:\r\n lb35:\r\n ld hl,1\r\n push hl\r\n ld hl, 264\r\n call getkey\r\n pop de\r\n call hleqde\r\n jpf lb38\r\n ;new PBullet{x,y};\r\n getfld .x\r\n new.arg .x\r\n getfld .y\r\n new.arg .y\r\n new PBullet,2,15,20\r\n foreach.a Enemy,5,14,nxx\r\n  ld a,h\r\n  ld hl,8\r\n  setfld .c\r\n  continue \r\n nxx:\r\n getthis 0\r\n \r\n \r\n jp lb37\r\n lb38:\r\n lb37:\r\n ;update();\r\n invoke .update\r\n jp lb23\r\n lb24:\r\n ret\r\nenddef 0\r\nendusr:\r\ngbl_player:dw 0\r\ngbl_pat_spr:dw 0\r\nspr.inipat:\r\n ld de,3800h\r\n ld hl,spr.pat\r\n ld bc,2048\r\n jp LDIRVM\r\nspr.pat:\r\ndb $c,$e,$f,$4f,$3d,$1d,$7f,$1b,$c,$3f,$7f,$7f,$6f,$f,$6,$c\r\ndb $18,$38,$f8,$f9,$de,$dc,$7f,$6c,$98,$fc,$fe,$fe,$f6,$f0,$60,$70\r\ndb $c,$e,$f,$4f,$3d,$1d,$7f,$1b,$c,$3f,$7f,$7f,$ef,$ef,$6,$6\r\ndb $18,$38,$f8,$f9,$de,$dc,$7f,$6c,$98,$fc,$fe,$fe,$d4,$78,$f0,$0\r\ndb $18,$1c,$1f,$9f,$7b,$3b,$fe,$36,$19,$3f,$7f,$7f,$2b,$1e,$f,$0\r\ndb $30,$70,$f0,$f2,$bc,$b8,$fe,$d8,$30,$fc,$fe,$fe,$f7,$f7,$60,$60\r\ndb $2c,$8e,$f,$4b,$3d,$11,$7f,$1d,$ca,$ff,$7f,$3f,$15,$1f,$e,$0\r\ndb $1c,$39,$f8,$e9,$de,$c4,$7f,$5c,$ab,$ff,$ff,$fe,$ac,$f8,$70,$0\r\ndb $1,$1,$1,$2,$3,$92,$96,$f6,$f6,$fe,$fe,$fe,$ff,$af,$26,$0\r\ndb $80,$80,$80,$40,$c0,$49,$69,$6f,$6f,$7f,$7f,$7f,$ff,$f5,$64,$0\r\ndb $8,$10,$30,$30,$18,$f,$3f,$37,$7b,$7d,$3f,$1f,$37,$60,$70,$c\r\ndb $8,$4,$6,$6,$c,$f8,$fe,$f6,$ef,$df,$fe,$fc,$f6,$3,$7,$18\r\ndb $0,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$1,$0,$0\r\ndb $80,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$80,$0\r\ndb $0,$0,$0,$0,$3,$f,$f,$1f,$1f,$1f,$1f,$f,$f,$3,$0,$0\r\ndb $0,$0,$0,$0,$c0,$f0,$f0,$f8,$f8,$f8,$f8,$f0,$f0,$c0,$0,$0\r\nbg.inipat:\r\n ret\r\n\r\n\r\nend main`,\r\n    't3':`org 09000h\r\n\r\ninclude tnu\r\ninclude mus\r\ninclude sprpat\r\n\r\n;===your code \r\n\r\nmain:\r\nld sp,(8000h)\r\n\r\ncall screen1\r\n\r\nshowsp\r\nshowlb endusr\r\n\r\nld hl,8000h\r\nld (hl),0cdh\r\nld de,8001h\r\nld bc,th.size*th.count-1\r\nldir\r\n\r\n\r\ncall th.init\r\ncall spr.inipat\r\n;call mus.ini\r\n\r\n\r\nnew Main, 0\r\nshow hl\r\n\r\n\r\nmovw (h.thlop),spr.puts\r\njp th.loop\r\n\r\nclass Main, RActor\r\n meth Main,main\r\n fld.bottom Object\r\n fld .x,100\r\n fld .y,300\r\n fld .p,0\r\n fld .c,3\r\n fld.bottom Sprite\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut \r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld.bottom RActor\r\n fld.bottom Main\r\n end.const\r\n\r\nMain.main:\r\n olp:\r\n  getthis\r\n  invoke .update\r\n  call xrnd.a\r\n  ld a,h\r\n  and 15\r\n  jr nz,doap\r\n   getthis\r\n   getfld .x\r\n   new.arg .x\r\n   getfld .y\r\n   new.arg .y\r\n   ld hl,7\r\n   call rnd.a\r\n   ld de,3\r\n   sbc hl,de\r\n   new.arg .vx\r\n   ld hl,5\r\n   call rnd.a\r\n   ld de,15\r\n   sbc hl,de\r\n   new.arg .vy\r\n   new Bullet, 4\r\n   call dstk\r\n  doap:\r\n  ld a,8\r\n  call SNSMAT.a\r\n  and 1\r\n  jr z,golf\r\n  \r\n  getthis\r\n  getfld .x\r\n  inc hl\r\n  inc hl\r\n  setfld .x\r\n  ld de,400\r\n  cpde.a\r\n  jp c, olp\r\n  golf:\r\n  ld hl,0\r\n  getthis\r\n  setfld .x\r\n jp olp\r\n\r\n\r\nclass Bullet,RActor\r\n meth Bullet,main\r\n fld.bottom Object\r\n fld .x, 0\r\n fld .y, 0\r\n fld .p, 2\r\n fld .c, 15\r\n fld.bottom Sprite\r\n meth RActor,onUpdate\r\n meth RActor,update\r\n meth RActor,screenOut \r\n meth RActor,die\r\n meth RActor,updateEx\r\n meth RActor,crashTo\r\n fld.bottom RActor\r\n fld .vy, -10\r\n fld .vx, 0\r\n fld.bottom Bullet\r\n end.const \r\n \r\nBullet.main:\r\n blp:\r\n  getthis\r\n  ;x+=vx\r\n  getfld .x\r\n  ex de, hl\r\n  getfld .vx\r\n  add hl,de\r\n  setfld .x\r\n  ; y+=vy\r\n  getfld .y\r\n  ex de, hl\r\n  getfld .vy\r\n  add hl,de\r\n  setfld .y\r\n  getfld .vy\r\n  inc hl\r\n  setfld .vy\r\n\r\n  invoke .update\r\n  invoke .screenOut\r\n  jp c, bdie\r\n  getfld .vy\r\n  bit 7,h\r\n  jr nz,blp\r\n  ld de,5\r\n  cpde.a\r\n  jr c,blp\r\n \r\n  call dstk\r\n  getthis\r\n  ld hl,3\r\n  setfld .p\r\n  pushi 10,bc\r\n  invoke .updateEx\r\n\r\n bleft:\r\n  getthis\r\n  ld hl,2\r\n  setfld .p\r\n  getfld .x\r\n  dec hl\r\n  dec hl\r\n  setfld .x\r\n  getfld .y\r\n  dec hl\r\n  setfld .y\r\n  invoke .update\r\n  invoke .screenOut\r\n  jr c, bdie\r\n  jr bleft\r\n bdie:\r\n  invoke .die\r\n  ret \r\n\r\n  \r\ndstk:\r\n push af\r\n ld hl,th.start+256*3\r\n getthis\r\n ld h,a\r\n ld de,1900h\r\n ld bc,256\r\n call LDIRVM\r\n pop af\r\n ret\r\n \r\nendusr:\r\nend main`,\r\n    't4':`org 09000h\r\njp main\r\ninclude const\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude tnu\r\ninclude sp\r\n\r\n;===your code \r\n\r\nright:dw 0\r\n\r\nmain:\r\ntnu.run Main\r\ndef Main.main,0,0\r\nnew.arg .vx,1\r\nnew.arg .vy,0\r\nnew.arg .x,0\r\nnew.arg .y,100\r\nnew Cat,4\r\n\r\nnew.arg .x,100\r\nnew.arg .y,100\r\nnew Target,2\r\n\r\nnew.arg .x,200\r\nnew.arg .y,100\r\nnew Target,2\r\n\r\n\r\nnew.arg .x,150\r\nnew.arg .y,100\r\nnew.arg .c,8\r\nnew NTarget,3\r\n\r\nld (right),hl\r\nld a,h\r\nld de,Actor\r\ncall instanceof\r\ncall showz\r\n\r\nld a,(right+1)\r\nld de,Target\r\ncall instanceof\r\ncall showz\r\n\r\nld a,(right+1)\r\nld de,Cat\r\ncall instanceof\r\ncall showz\r\n\r\n\r\nld hl,1\r\nsetfld .c\r\nenddef 0\r\n\r\nclass Main,Actor\r\n Actor.noovr Main\r\n end.const 0\r\nclass Target,Actor\r\n Actor.noovr Target\r\n met2 Target,.push\r\n end.const 0\r\nclass NTarget,Actor\r\n Actor.noovr NTarget\r\n end.const 0\r\ndef NTarget.main,0,0\r\n ret\r\nenddef\r\n\r\ndef Target.main,0,0\r\nenddef\r\nclass Cat,Actor\r\n Actor.noovr Cat\r\n fld .vy, 0\r\n fld .vx, 0\r\n fld.bottom Cat\r\n end.const 0\r\ndef Cat.main,0,0\r\n blp:\r\n  getthis\r\n  ;x+=vx\r\n  getfld .x\r\n  ex de, hl\r\n  getfld .vx\r\n  add hl,de\r\n  setfld .x\r\n  ; y+=vy\r\n  getfld .y\r\n  ex de, hl\r\n  getfld .vy\r\n  add hl,de\r\n  setfld .y\r\n  ld hl,Target\r\n  push hl\r\n  invoke .crashTo\r\n  jpf cr\r\n   ; r.x+=10\r\n   const setg,hl\r\n   getfldtg .y\r\n   ld de,30\r\n   add hl,de\r\n   push hl\r\n   ldconst hl,setg\r\n   setfldtg .y\r\n  cr:\r\n  invoke .update\r\n jp blp\r\nenddef\r\ndef Target.push,0,0\r\n ld hl,3\r\n setfld .p\r\n repti 30,pse\r\n  getfld .y\r\n  inc hl\r\n  setfld .y\r\n  invoke .update\r\n  continue\r\n pse:\r\n ld hl,0\r\n setfld .p\r\nenddef\r\n\r\nendusr: \r\nend main\r\nhttps://msxpen.com/codes/-N6DDfMvZq9aUeJ9JLpN\r\nhttps://msxpen.com/codes/-N6QGYk-rr5iDuTtHpF7`,\r\n    't5':`org 9000h\r\n\r\n\r\ninclude key\r\n\r\nmain:\r\ncall keyall\r\nld hl,0108h\r\ncall getkey\r\nshow hl\r\nld hl,0107h\r\ncall getkey\r\nshow hl\r\n\r\n\r\nhalt\r\njp main`,\r\n    'gen':`org 09000h\r\ninclude tnu\r\ninclude bool\r\n\r\nmain:\r\ntnu.run Main\r\nclass Main,Actor\r\n Actor.noovr Main\r\n end.const 0\r\ndef Main.main,0,0\r\n\r\n showlb .main\r\n showlb .crashTo\r\nenddef 0\r\nendusr:\r\nend main`,\r\n    'dac':`org 09000h\r\njp main\r\ninclude const\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude th\r\n\r\n\r\nDECSUB equ 268CH;DAC ← DAC-ARG\r\nDECADD equ 269AH;DAC ← DAC+ARG\r\nDECNRM equ 26FAH;DAC を正規化する (*1)\r\nDECROU equ 273CH;DAC を四捨五入する\r\nDECMUL equ 27E6H;DAC ← DAC*DAC\r\nDECDIV equ 289FH;DAC ← DAC/DAC\r\nMAF equ 2C4DH;ARG ← DAC\r\nMAM equ 2C50H;ARG ← [HL]\r\nMOV8DH equ 2C53H;[DE] ← [HL]\r\nMFA equ 2C59H;DAC ← ARG\r\nMFM equ 2C5CH;[HL] ← DAC\r\nMMF equ 2C67H;[HL] ← DAC\r\nMOV8HD equ 2C6AH;[HL] ← [DE]\r\nXTF equ 2C6FH;[SP] ←→ DAC\r\nPHA equ 2CC7H;ARG → [SP]\r\nPHF equ 2CCCH;DAC → [SP]\r\nPPA equ 2CDCH;[SP] → ARG\r\nPPF equ 2CE1H;[SP] → DAC\r\nPUSHF equ 2EB1H;DAC → [SP]\r\nMOVFM equ 2EBEH;DAC ← [HL]\r\nMOVFR equ 2EC1H;DAC ← (CBED)\r\nMOVRF equ 2ECCH;(CBED) ← DAC\r\nMOVRMI equ 2ED6H;(CBDE) ← [HL]\r\nMOVRM equ 2EDFH;(BCDE) ← [HL]\r\nMOVMF equ 2EE8H;[HL] ← DAC\r\nMOVE equ 2EEBH;[HL] ← [DE]\r\nVMOVAM equ 2EEFH;ARG ← [HL]\r\nMOVVFM equ 2EF2H;[DE] ← [HL]\r\nVMOVE equ 2EF3H;[HL] ← [DE]\r\nVMOVFA equ 2F05H;DAC ← ARG\r\nVMOVFM equ 2F08H;DAC ← [HL]\r\nVMOVAF equ 2F0DH;ARG ← DAC\r\nVMOVMF equ 2F10H;[HL] ← DAC\r\n\r\nVALTYP equ 0F663H;1\r\nDAC equ 0F7F6H;16\r\nARG equ 0F847H;16\r\nFOUT equ 3425H\r\n\r\ndefsub int2dac\r\n push af\r\n ld a,2\r\n ld (VALTYP),a\r\n ld (DAC+2),HL\r\n pop af\r\nendsub int2dac\r\n;===your code \r\n\r\nmain:\r\nld hl,12345\r\ncall int2dac\r\nld hl,str\r\ncall FOUT\r\n\r\nld b,10\r\nreptb nxt\r\n ld a,(hl)\r\n cp 0\r\n break z\r\n call wrt2\r\n inc hl\r\n continue\r\nnxt:\r\nret\r\nstr:\r\n\r\n\r\n`,\r\n    'setvrm':`org 09000h\r\njp main\r\ninclude const\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude th\r\n\r\n;===your code \r\n\r\nmain:\r\nld hl,1800h\r\ncall SETWRT\r\nld a,35\r\nrepti 5, ed\r\ninc a\r\nout (98h),a\r\ncontinue\r\ned:\r\nret`,\r\n    'assert':`include mem\r\ninclude math\r\ninclude debug\r\n\r\na.reg.trc:\r\ndw 0\r\na.reg.adr:\r\ndw 0\r\na.reg.min:\r\ndw 0\r\na.reg.val:\r\ndw 0\r\na.reg.max:\r\ndw 0\r\nmacro a.regi,n,v\r\n push hl\r\n ld hl,v\r\n ld (a.reg.##n),hl\r\n pop hl\r\nendm\r\nmacro a.regr,n,v\r\n ld (a.reg.##n),v\r\nendm\r\n\r\nmacro a.dummy\r\n local a.reg.,trc,adr,min,val,nax\r\nendm\r\n \r\n\r\nmacro assert.eq,o\r\n storelastpc\r\n pushall \r\n if not nul o\r\n  a.regi val, o\r\n endif\r\n ld de,(a.reg.val)\r\n ld(a.reg.val),hl\r\n ld(a.reg.min),de\r\n ld(a.reg.max),de\r\n cpde\r\n jp nz,assert.fail\r\n popall\r\nendm\r\n\r\nmacro assert.do,nx\r\n storelastpc\r\n pushall\r\n call to\r\n popall\r\n jr nx\r\n to:\r\nendm\r\n\r\nmacro storelastpc\r\n push hl\r\n call getpc\r\n ld (lastpc),hl\r\n pop hl\r\nendm\r\nlastpc:\r\n dw 0\r\n \r\ngetpc:\r\n pop hl\r\n push hl\r\n ret\r\n\r\nassert.fail:\r\n ld hl,0deadh\r\n show hl\r\n showm a.reg.trc\r\n showm a.reg.min\r\n showm a.reg.val\r\n showm a.reg.max\r\n showm a.reg.adr\r\n showm lastpc\r\n call freeze\r\nmacro assert.meqw,ad,val\r\n a.regi adr,ad\r\n push hl\r\n ld hl,(ad)\r\n assert.eq val\r\n pop hl\r\nendm\r\n `,\r\n    'stksz':`org 09000h\r\njp main\r\ninclude const\r\ninclude ctrl\r\ninclude math\r\ninclude debug\r\ninclude sub\r\ninclude mem\r\ninclude th\r\n\r\n\r\n;===your code \r\n\r\nsz equ 256\r\n  \r\nmain:\r\nld hl,0fd9fh\r\nld (hl),0c9h\r\n rept sz/2\r\n  push hl\r\n endm\r\n rept sz/2\r\n  pop hl\r\n endm\r\n\r\nloop:\r\n getsp\r\n ld de,-sz\r\n add hl,de\r\n ld de,1800h\r\n ld bc,sz\r\n call LDIRVM\r\n ld hl,0\r\n halt\r\n jp loop\r\n \r\n \r\n `,\r\n    'vdp':`;https://www.msx.org/wiki/VDP_Status_Registers\r\n;st 0 bit 7\r\n;read 1\r\n\r\n;https://www.msx.org/wiki/VDP_Mode_Registers\r\n;ctrl 1 bit 5 set 0\r\ninclude const\r\n\r\nsusint:\r\n ld a,(RG1SAV)\r\n res 5,a\r\n ld b,A\r\n ld c,1\r\n jp WRTVDP\r\n;rstint:\r\n ld a,(RG1SAV)\r\n set 5,a\r\n ld b,A\r\n ld c,1\r\n jp WRTVDP\r\ninted:\r\n call RDVDP\r\n bit 7,a\r\n ret\r\ndoint:\r\n call inted\r\n jr z, norst\r\n ld hl,timecnt\r\n inc (hl)\r\n call h.tntimi\r\n norst:\r\n ;call rstint\r\n ret\r\nh.tntimi:\r\n ld A,(timecnt)\r\n ld hl,1ae0h\r\n call 4dh\r\n ret\r\n ds 16\r\n \r\ntimecnt:\r\ndb 0\r\nmacro vdptest\r\nlocal stk1,stk2,stk3,vl\r\nstk1:\r\n ds 256,35\r\nstk2:\r\n ds 256,42\r\nstk3:\r\n\r\nvl:\r\n call susint\r\n ld sp,stk2\r\n ld hl,stk1\r\n ld de,1800h\r\n ld bc,256\r\n call LDIRVM\r\n \r\n \r\n ld sp,stk3\r\n call doint\r\n ld hl,stk2\r\n ld de,1900h\r\n ld bc,256\r\n call LDIRVM\r\n jp vl\r\nendm\r\n \r\nscreen1:\r\n ld a,1\r\n call CHGMOD\r\n ld a,(RG1SAV)\r\n set 1,a\r\n ld b,A\r\n ld c,1\r\n call WRTVDP\r\n ret\r\n\r\ndefsub screen2\r\n ld a,2\r\n call CHGMOD\r\n ld a,(RG1SAV)\r\n set 1,a\r\n ld b,A\r\n ld c,1\r\n call WRTVDP\r\nendsub screen2\r\n `,\r\n    'mus':`include mem\r\nmus.ini:\r\n di\r\n ld hl,0fd9fh\r\n ld (hl),0c3h\r\n movw (0fd9fh+1),mus\r\n ei\r\n ret\r\nmus:\r\nproc\r\nlocal we\r\n push af\r\n push de\r\n ld a,(we-1)\r\n xor 15\r\n ld (we-1),a \r\n ld a,8\r\n ld e,15\r\n we:\r\n call WRTPSG\r\n pop af \r\n pop de\r\n ret\r\nendp`,\r\n};","extends TObject;\r\nlet idx=256-4-2;\r\nlet _n2idx={};//optimized\r\nlet _n2seq={};//not optimized\r\n\r\n\\fldidx(){\r\n    let def=`Actor.noovr,Class\r\n fld .class,Class\r\n meth Class,main\r\n fld.bottom Object\r\n fld .x, 0\r\n fld .y, -1024\r\n fld .p, 0\r\n fld .c, 3\r\n fld.bottom Sprite\r\n meth Actor,onUpdate\r\n meth Actor,update\r\n meth Actor,screenOut \r\n meth Actor,die\r\n meth Actor,updateEx\r\n meth Actor,crashTo\r\n fld.bottom Actor\r\nendm\r\n`;\r\n    let fldp=/fld \\.(\\w+)/;\r\n    let metp=/meth.*,(\\w+)/;\r\n    idx=256-4-2;\r\n    let res={};\r\n    for(let ln of def.split(\"\\n\")){\r\n        let m=fldp.exec(ln)||\r\n        metp.exec(ln);\r\n        if(m){\r\n            res [m [1]]=idx;\r\n            /*print(m [1],idx.\r\n            toString(16));*/\r\n            n2seq(m[1]);\r\n            idx-=2;\r\n        }\r\n    }\r\n    _n2idx=res;\r\n    return res;\r\n}\r\nlet confli={};\r\nfldidx();\r\n//print(n2seq);\r\n/*print(n2idx(\"y\"));\r\nprint(n2idx(\"t\").toString(16));\r\nprint(idx2n(250));*/\r\n/*addMembers([\"x\",\"y\",\"test\",\"cnt\"]);\r\naddMembers([\"x\",\"y\",\"cnt\",\"toste\"]);\r\naddMembers([\"x\",\"y\",\"ttt\",\"toste\"]);*/\r\n//print(confli);\r\n//print(_n2seq);\r\nbuild();\r\n\\build(){\r\n    for (let n of Object.keys(_n2seq)) {\r\n        if (!_n2idx[n]) _n2idx[n]=idx;\r\n    }\r\n    //print(_n2idx);\r\n    while(true) {\r\n        let cont=false;\r\n        for (let k,i of confli) {\r\n            k=k.split(\"\\t\");\r\n            if (_n2idx[k[0]]==_n2idx[k[1]]) {\r\n                _n2idx[k[1]]-=2;\r\n                cont=true;\r\n            }\r\n        }\r\n        if (!cont) break;\r\n    }\r\n    //print(_n2idx);\r\n}\r\n\r\n\r\n\\n2idx(n:String){\r\n    let r=_n2idx [n];\r\n    if(r)return r;\r\n    throw new Error(\r\n    `${n} is not found`);\r\n}\r\n\\n2seq(n:String){\r\n    let r=_n2seq [n];\r\n    if(r!=null)return r;\r\n    r=Object.keys(\r\n    _n2seq).length;\r\n    _n2seq[n]=r;\r\n    return r;\r\n}\r\n\\idx2n(i:Number){\r\n    for(let k,v in _n2idx){\r\n        if(v==i)return k;\r\n    }\r\n    return null;\r\n}\r\n\\addConfli(a:String, b:String) {\r\n    if (a==b) return;\r\n    if (n2seq(a)>n2seq(b)){\r\n        return addConfli(b,a);\r\n    }\r\n    confli[a+\"\\t\"+b]=true;\r\n}\r\n\\isConfli(a:String, b:String) {\r\n    if (a==b) return true;\r\n    if (n2seq(a)>n2seq(b)){\r\n        return isConfli(b,a);\r\n    }\r\n    return confli[a+\"\\t\"+b]=true;\r\n}\r\n\\addMembers(names:String[]) {\r\n    for (let name of names) {\r\n        for (let name2 of names) {\r\n            addConfli(name,name2);\r\n        }\r\n    }\r\n}\r\n","extends TObject;\nnative console;\nlet indentBuf=\"\";\nlet indentStr=\" \";\nlet buf=new StringBuilder;\nlet visitor:Visitor;\n\\initModule(){\n    indentBuf=\"\";\n    indentStr=\" \";\n    buf=new StringBuilder;\n    visitor=this;\n}\n\\printf() {\n    let ap=new ArgParser(arguments);\n    function shiftArg(nullable) {\n        let res=ap.shift();\n        if (res==null && !nullable) {\n            console.log(ap);\n            throw new Error(\n            \"null param: fmt=\"+fmt);\n        }\n        return res;\n    }\n    let fmt=shiftArg();\n    while (true) {\n        let i=fmt.indexOf(\"%\");\n        if (i<0) {printraw(fmt); break;}\n        printraw(fmt.substring(0,i));\n        i++;\n        let fstr=fmt.charAt(i);\n        if (fstr==\"s\") {\n            let str=shiftArg();\n            if (typeof str == \"string\" || typeof str ==\"number\") {}\n            else if (str==null) str=\"null\";\n            else if (str.text) {\n                addMapping(str);\n                str=str.text;\n            }\n            printraw(str);\n            i++;\n        } else if (fstr==\"d\") {\n            let n=shiftArg();\n            if (typeof n!=\"number\") throw new Error (n+\" is not a number: fmt=\"+fmt);\n            printraw(n);\n            i++;\n        } else if (fstr==\"n\") {\n            ln();\n            i++;\n        } else if (fstr==\"{\") {\n            indent();\n            i++;\n        } else if (fstr==\"}\") {\n            dedent();\n            i++;\n        } else if (fstr==\"%\") {\n            printraw(\"%\");\n            i++;\n        } else if (fstr==\"f\") {\n            shiftArg()($);\n            i++;\n        /*} else if (fstr==\"l\") {\n            let lit=shiftArg();\n            printraw(toLiteral(lit));\n            i++;*/\n        } else if (fstr==\"v\") {\n            let a=shiftArg();\n            if (!a) throw new Error (\"Null %v\");\n            if (typeof a!=\"object\") throw new Error(\"nonobject %v:\"+a);\n            addMapping(a);\n            visitor.visit(a);\n            i++;\n        /*} else if (fstr==\"z\") {\n            let place=shiftArg();\n            if (\"val\" in place) {\n                printraw(place.val);\n                return;\n            }\n            if (!place.inited) {\n                lazy(place);\n            }\n            place.printraw();\n            i++;*/\n        } else if (fstr==\"j\") {\n            let sp_node=shiftArg();\n            let sp=sp_node[0];\n            let node=sp_node[1];\n            let sep=false;\n            if (!node || !node.forEach) {\n                console.log(node);\n                throw new Error (node+\" is not array. cannot join fmt:\"+fmt);\n            }\n            for (let n of node) {\n                if (sep) printf(sp);\n                sep=true;\n                visitor.visit(n);\n            }\n            i++;\n        } else if (fstr==\"D\"){\n            shiftArg(true);\n            i++;\n        } else {\n            i+=2;\n        }\n        fmt=fmt.substring(i);\n    }\n}\n\n\\ln() {\n\t\t\n    printraw(\"\\n\"+indentBuf);\n}\n\\indent() {\n\n    indentBuf+=indentStr;\n    printraw(\"\\n\"+indentBuf);\n}\n\\dedent() {\n    let len=indentStr.length;\n    if (!buf.last(len).match(/^\\s*$/)) {\n        console.log(buf);\n        throw new Error (\"Non-space truncated \");\n    }\n    buf.truncate(len);//=buf.substring(0,buf.length-len);\n    indentBuf=indentBuf.substring(0 , indentBuf.length-len);\n}\n//let debug=false;\n\\addMapping(){}\n\\printraw(s){\n    buf.append(s);\n}\n","extends null;\n\\enter(newval, act) {\n    let sv={};\n    let curval=this;\n    for (let k in newval) {\n        sv[k]=curval[k];\n        curval[k]=newval[k];\n    }\n    let res=act(this);\n    for (let k in sv) {\n        curval[k]=sv[k];\n    }\n    return res;\n}\n","extends TObject;\nnative console;\nnative Math;\nlet buf:String []=[\"\"];\nlet bufSize=1024;\nfunction rest(lastIdx) {\n    return bufSize-buf[lastIdx].length;\n}\nfunction validate() {\n    for (let i=0;i<buf.length-1;i++) {\n        if (buf[i].length!==bufSize) {console.log(buf); throw new Error(\"NO!\"); }\n    }\n}\nfunction append(content) {\n    content=content+\"\";\n    while(content) {\n        let lastIdx=buf.length-1;\n        let r=rest(lastIdx);\n        if (content.length<=r) {\n            buf[lastIdx]+=content;\n            break;\n        } else {\n            buf[lastIdx]+=content.substring(0,r);\n            buf.push(\"\");\n            content=content.substring(r);\n        }\n    }\n    validate();\n}\nfunction rowcol(index) {\n    let row=Math.floor(index/bufSize);\n    let col=index % bufSize;\n    return {row,col};\n}\nfunction replace(index, replacement) {//replacement.length<= bufSize\n    replacement=replacement+\"\";\n    if (replacement.length>bufSize) {\n        throw new Error(\"Cannot replace over len=\"+bufSize);\n    }\n    let start=rowcol(index);\n    let end=rowcol(index+replacement.length);\n    if (start.row===end.row) {\n        let line=buf[start.row];\n        buf[start.row]=line.substring(0,start.col)+replacement+line.substring(end.col);\n    } else {\n        let line1=buf[start.row];\n        let line2=buf[end.row];\n        let len1=bufSize-start.col;\n        let len2=replacement.length-len1;\n        buf[start.row]=line1.substring(0,start.col)+replacement.substring(0, len1);\n        buf[end.row]=replacement.substring(len1)+line2.substring(len2);\n    }\n    validate();\n}\nfunction truncate(length) {\n    while(true) {\n        let lastIdx=buf.length-1;\n        let dec=buf[lastIdx].length-length;\n            //console.log(buf,length, lastIdx,dec);\n        if (dec>=0) {\n            buf[lastIdx]=buf[lastIdx].substring(0,dec);\n            break;\n        } else {\n            buf.pop();\n            length=-dec;// <=> l-=bl <=> l=l-bl <=> l=-(bl-l) <=> l=-dec\n        }\n    }\n    validate();\n\n}\nfunction getLength() {\n    let lastIdx=buf.length-1;\n    return bufSize*lastIdx+buf[lastIdx].length;\n}\nfunction last(len) {\n    if (len>bufSize) {\n        throw new Error(\"Cannot replace over len=\"+bufSize);\n    }\n    let lastIdx=buf.length-1;\n    let deced=buf[lastIdx].length-len;\n    if (deced>=0) {\n        return buf[lastIdx].substring(deced);\n    } else {\n        return buf[lastIdx-1].substring(bufSize+deced)+buf[lastIdx];\n    }\n}\nfunction toString() {\n    return buf.join(\"\");\n}\n","extends Actor;\n\\visit(n){\n    let k=n && \"v_\"+n.type;\n    if(n&&\n    typeof this [k]==\n    \"function\"){\n        return this [k](n);\n    }\n    return def(n);\n}\n\\def(o){\n    if(!o)return;\n    for(let k,v in o){\n        visit(o);\n    }\n}","extends TObject;\nlet asms=new Asms;\nlet incled;\nfunction gensrc(src){\n    incled={};\n    return writeConfig(incl(src));\n}\nfunction writeConfig(src) {\n    for (let k,v in $config) {\n        let r=new RegExp(k.replace(/\\./g,\"\\\\.\")+\"\\\\s+equ\\\\s+[^\\\\n]+\");\n        src=src.replace(r,`${k} equ ${v}`);\n    }\n    return src;\n}\nfunction incl(src){\n    return src.split(\"\\n\").\n    map(inclf).\n    join(\"\\n\");\n}\nlet cmtp=/;([^\\n]+)/gi;\nlet inclp=\n/^include ([\\d\\w]+)/; \nfunction inclf(line){\n    var m=inclp.exec(line);\n    if(!m)return line;\n    var f=m[1];\n    if(incled[f])return \"\";\n    incled[f]=1;\n    return \n    \";include \"+f+\"\\n\"+\n    incl(asms.data[f])+\n    \"\\n\"+\n    \";end of include \"+f;\n}","extends Boot;\r\n\r\n\\config() {\r\n    $config={\r\n        \"spr.scale\"=1,\r\n        //\"crashTo.size\"=32,\r\n        \"obj.limits\"={\r\n            PBullet: 5, Enemy: 10\r\n        },\r\n        \"th.count\"=20,\r\n\r\n        // unimplemented: the variables treated as double(common to all classes) \r\n        \"defdbl\": [\r\n        \"dbl\",\"$dbl\",\r\n        /^f_/,/^\\$f_/,\r\n        ],\r\n        // unimplemented: global arrays\r\n        \"arrays\": {\r\n            \"$mem\": 50, // int16[50]\r\n            \"$ary\": [1,10,100], // int16[3] with initial values\r\n            \"$mat\": [[1,3,5],[10,12]], // (int*)[2] \r\n            // [1,3,5] and [10,12] may not be placed in contiguous memory areas.\r\n            \"$f_ary\": [1.2, 2.3, 4.5] //double[3] \r\n        },\r\n        // unimplemented: global strings(char*). length cannot be changed.\r\n        \"strings\": {\r\n            \"$mesg\": \"Hello, world\", // char*\r\n            //substring: $mesg+7 -> \"world\"\r\n            \"$mesgs\": [\"Hello\", \"World!!\"], // (char*)[2]\r\n            // \"Hello\" and \"World!!\" may not be placed in contiguous memory areas.\r\n            //\"$f_str\": \"ERROR! float cannot point string\",\r\n        }\r\n    };\r\n}\r\n\\createMainObject() {\r\n    //--config section---\r\n    config();\r\n    //--------\r\n    getMainClass();\r\n    $excludeFromAll=$Screen.all();\r\n    $Screen.resize(512,512);\r\n    $MScreen=new Screen{x:256,y:224,width:256,height:192,scaleX:2};\r\n    $MLayer=$MScreen.addLayer();\r\n    $crashTo_size=8<<$config[\"spr.scale\"];\r\n    $RSprPat=new RSprPat;\r\n    $MScreen.setBGColor($RSprPat.palette[3]);\r\n    $Screen.setBGColor($RSprPat.palette[6]);\r\n    $pat_font_orig=$pat_font;\r\n    $pat_font=0;\r\n    $map=new Map2{chipWidth:8,chipHeight:8,row:24,col:32,layer:$MLayer, x:0,y:0};\r\n    //for (let y=0;y<24;y++) for(let x=0;x<32;x++) $map.set(x,y,$pat_font+35);\r\n    $exporter=new GenAsm;\r\n    let ide=$Boot.getIDE();\r\n    if (ide && $Navigator.isMobile()) ide.runDialog.resize {\r\n        left:10,top:300,width:400,\r\n        height:400\r\n    };\r\n    if ($editButton) {\r\n        new Button{top:480,text:\"Edit Page\",height:30, \r\n            fillStyle:$RSprPat.palette[4],\r\n            onClick:\\{$editButton.openEditor();}\r\n        };\r\n    }\r\n    $mainClassName=mainClass.meta.shortName;\r\n    new mainClass;\r\n}\r\nsuper.main();\r\n","extends TObject;\nnative Tonyu;\n\\u(obj) {\n    return Object.assign({},obj);\n}\n\\getMembers(klass){\n    let d=klass.decls;\n    let f=(d.fields),m=(d.methods);\n    let s=klass.superclass;\n    //print(klass.shortName, klass, f,m);\n    let res={};\n    if(klass.shortName!=\"RActor\" && s)res=getMembers(s);\n    //let p=Tonyu.iterator2(f);\n\n    for(let n,v in f){\n        res [n]={\n            type=\"fld\",\n            declin=klass\n        };\n    }\n    for(let n,v in m){\n        if (n==\"new\") continue;\n        res [n]={\n            type=\"meth\",\n            declin=klass\n        };\n    }\n    return res;\n}\n\\inherits(klass, parent) {\n    if (klass===parent) return true;\n    if (!klass.superclass) return false;\n    return inherits(klass.superclass,parent);\n}\nlet genasm:GenAsm;\nlet anodes=genasm.anodes;\nlet Za=(anodes.filter \\(e){\n    return e.shortName===\"RActor\";\n}[0]);\nlet fld=new FldIdx;\nlet ks=anodes.filter \\(klass){\n    return\n    inherits(klass, Za) &&\n    klass!==Za;\n};\nlet obj_limits=initLimitRange($config[\"obj.limits\"]||{});\nlet name2klass={};\nfor (let klass of ks) {\n    name2klass[klass.shortName]=klass;\n    proc(klass);\n}\nfld.build();\n/*\nfor (let klass of ks) {\n    header(klass);\n}*/\n\\initLimitRange(lims) {\n    let res={};\n    let base={};\n    let allCnt=$config[\"th.count\"], cur=allCnt;\n    for (let klass, num in lims) {\n        res[klass]=[cur-num, cur];\n        cur-=num;\n    }\n    if (cur<0) {\n        throw new Error(`Config error: obj.limit exceeded th.count(${allCnt})`);\n    }\n    res[\"*\"]=[0,cur];\n    return res;\n}\n\\objRange(klass) {\n    for (let klassEnt, num in obj_limits) {\n        klassEnt=name2klass[klassEnt];\n        if (inherits(klass, klassEnt)) return num;\n    }\n    return obj_limits[\"*\"];\n}\n\n\\proc(klass){\n    //print(klass);\n    let r=getMembers(klass);\n    fld.addMembers(\n    Object.keys(r));\n    /*for (let k,v in r){\n        print(k,v.type,v.declin.shortName);\n    }*/\n}\n\\header(klass){\n    let r=getMembers(klass);\n    let min=256,max=0;\n    let rev={};\n    printf(\"class %s,%s%{\",\n    klass.shortName,\n    klass.superclass.shortName);\n    for (let k,v in r){\n        let i=fld.n2idx(k);\n        if(i<min)min=i;\n        if(i>max)max=i;\n        rev [i]=k;\n    }\n    for(let i=max;i>=min;i-=2){\n        let k=rev [i];\n        if(!k){\n            printf(\"unused%n\");\n            continue;\n        }\n        let ri=r [k];\n        if(ri.type==\"fld\"){\n            printf(\"fld .%s,0%n\",k);\n        }else {\n            printf('meth %s,%s%n',\n            ri.declin.shortName,\n            k);\n        }\n    }\n    printf(\"end.const %s%n%}\",klass.shortName);\n}\n\\printf() {\n    genasm.printf.apply(genasm,arguments);\n}\n//print(t);","extends null;\nlet decls;//: C_Decls;\r\nlet superclass: C_Meta;\r\n//let includes: C_Meta[];\r\nlet\tsrc;//: {tonyu?:any, js?:any, map?: string},\r\nlet node: Program;\r\nlet annotation;//: object,","extends null;\r\nlet type:String;\r\n","extends null;\nlet klass: C_Meta;\r\nlet node: FuncDecl;\r\nlet head: FuncDeclHead;\r\nlet ftype:String;\r\nlet name: String;\r\nlet isMain: Boolean;\r\nlet stmts: Stmt[];\r\nlet locals: Locals;\r\nlet params: ParamDecl[];\r\nlet scope;//: ScopeMap;\r\nlet useArgs:Boolean;\r\nlet paramTypes;//: AnnotatedType[];\r\nlet returnType;//: AnnotatedType;\r\n//let nowait: Boolean;","extends null;\nlet varDecls;//: {[key: string]:VarDecl},\r\nlet subFuncDecls;//: {[key: string]:FuncDecl},","extends null;\nlet type:String;\nlet row:Number;\nlet col:Number;\nlet pos:Number;\nlet len:Number;\nlet text:String;","extends null;\nincludes TNode,Stmt;\nlet stmt:Stmt;\nlet catches:Catches[];\n","extends null;\nincludes TNode;\nlet vtype:TypeExpr;\n","extends null;\nincludes TNode;\nlet name:Token;\n","extends null;\nincludes TNode;\nlet name:Token;\nlet typeDecl:TypeDecl?;\nlet value:Expression?;\n","extends null;\nincludes TNode,Stmt;\nlet decls:VarDecl[];\nlet declPrefix: Token;","extends null;\nincludes TNode,Stmt;\nlet cond:Expression;\nlet loop:Stmt;\n","extends VisitorBase;\n\\v_String(n:Token){\n    let text:String=n.text;\n    def(n);\n}\n\\v_prefix(n:Prefix){\n    let op:Token=n.op;\n    let right:Expression=n.right;\n    def(n);\n}\n\\v_postfix(n:Postfix){\n    let left:Expression=n.left;\n    let op:TNode=n.op;\n    def(n);\n}\n\\v_infix(n:Infix){\n    let left:Expression=n.left;\n    let op:Token=n.op;\n    let right:Expression=n.right;\n    def(n);\n}\n\\v_trifix(n:Trifix){\n    let left:Expression=n.left;\n    let op1:Token=n.op1;\n    let mid:Expression=n.mid;\n    let op2:Token=n.op2;\n    let right:Expression=n.right;\n    def(n);\n}\n\\v_arrayElem(n:ArrayElem){\n    let subscript:Expression=n.subscript;\n    def(n);\n}\n\\v_argList(n:ArgList){\n    let args:Expression[]=n.args;\n    def(n);\n}\n\\v_member(n:Member){\n    let name:Token=n.name;\n    def(n);\n}\n\\v_parenExpr(n:ParenExpr){\n    let expr:Expression=n.expr;\n    def(n);\n}\n\\v_varAccess(n:VarAccess){\n    let name:Token=n.name;\n    def(n);\n}\n\\v_funcExprArg(n:FuncExprArg){\n    let obj:FuncExpr=n.obj;\n    def(n);\n}\n\\v_objlitArg(n:ObjlitArg){\n    let obj:Objlit=n.obj;\n    def(n);\n}\n\\v_call(n:Call){\n    let args:Expression[]=n.args;\n    def(n);\n}\n\\v_scall(n:Scall){\n    let args:Expression[]=n.args;\n    def(n);\n}\n\\v_newExpr(n:NewExpr){\n    let klass:VarAccess=n.klass;\n    let params:Call?=n.params;\n    def(n);\n}\n\\v_superExpr(n:SuperExpr){\n    let name:Token?=n.name;\n    let params:Scall=n.params;\n    def(n);\n}\n\\v_exprstmt(n:Exprstmt){\n    let expr:Expression=n.expr;\n    def(n);\n}\n\\v_compound(n:Compound){\n    let stmts:Stmt[]=n.stmts;\n    def(n);\n}\n\\v_return(n:Return){\n    let value:Expression?=n.value;\n    def(n);\n}\n\\v_if(n:If){\n    let cond:Expression=n.cond;\n    let then:Stmt=n.then;\n    let _else:Stmt?=n._else;\n    def(n);\n}\n\\v_forin(n:Forin){\n    let isVar:Token?=n.isVar;\n    let vars:Token[]=n.vars;\n    let inof:Token=n.inof;\n    let set:Expression=n.set;\n    def(n);\n}\n\\v_normalFor(n:NormalFor){\n    let init:Stmt=n.init;\n    let cond:Expression?=n.cond;\n    let next:Expression?=n.next;\n    def(n);\n}\n\\v_for(n:For){\n    let inFor:ForHead=n.inFor;\n    let loop:Stmt=n.loop;\n    def(n);\n}\n\\v_while(n:While){\n    let cond:Expression=n.cond;\n    let loop:Stmt=n.loop;\n    def(n);\n}\n\\v_do(n:Do){\n    let loop:Stmt=n.loop;\n    let cond:Expression=n.cond;\n    def(n);\n}\n\\v_case(n:Case){\n    let value:Expression=n.value;\n    let stmts:Stmt[]=n.stmts;\n    def(n);\n}\n\\v_default(n:Default){\n    let stmts:Stmt[]=n.stmts;\n    def(n);\n}\n\\v_switch(n:Switch){\n    let value:Expression=n.value;\n    let cases:Case[]=n.cases;\n    let defs:Default?=n.defs;\n    def(n);\n}\n\\v_break(n:Break){\n    let brk:Token=n.brk;\n    def(n);\n}\n\\v_continue(n:Continue){\n    let cont:Token=n.cont;\n    def(n);\n}\n\\v_finally(n:Finally){\n    let stmt:Stmt=n.stmt;\n    def(n);\n}\n\\v_catch(n:Catch){\n    let name:Token=n.name;\n    let stmt:Stmt=n.stmt;\n    def(n);\n}\n\\v_try(n:Try){\n    let stmt:Stmt=n.stmt;\n    let catches:Catches[]=n.catches;\n    def(n);\n}\n\\v_throw(n:Throw){\n    let ex:Expression=n.ex;\n    def(n);\n}\n\\v_typeExpr(n:TypeExpr){\n    let name:Token=n.name;\n    def(n);\n}\n\\v_typeDecl(n:TypeDecl){\n    let vtype:TypeExpr=n.vtype;\n    def(n);\n}\n\\v_varDecl(n:VarDecl){\n    let name:Token=n.name;\n    let typeDecl:TypeDecl?=n.typeDecl;\n    let value:Expression?=n.value;\n    def(n);\n}\n\\v_varsDecl(n:VarsDecl){\n    let decls:VarDecl[]=n.decls;\n    def(n);\n}\n\\v_paramDecl(n:ParamDecl){\n    let name:Token=n.name;\n    let typeDecl:TypeDecl?=n.typeDecl;\n    def(n);\n}\n\\v_paramDecls(n:ParamDecls){\n    let params:ParamDecl[]=n.params;\n    def(n);\n}\n\\v_setterDecl(n:SetterDecl){\n    let value:ParamDecl=n.value;\n    def(n);\n}\n\\v_funcDeclHead(n:FuncDeclHead){\n    let _nowait:Token?=n._nowait;\n    let ftype:Token?=n.ftype;\n    let name:Token=n.name;\n    let setter:SetterDecl?=n.setter;\n    let params:ParamDecls?=n.params;\n    let rtype:TypeDecl?=n.rtype;\n    def(n);\n}\n\\v_funcDecl(n:FuncDecl){\n    let head:FuncDeclHead=n.head;\n    let body:Compound=n.body;\n    def(n);\n}\n\\v_nativeDecl(n:NativeDecl){\n    let name:Token=n.name;\n    def(n);\n}\n\\v_ifWait(n:IfWait){\n    let then:Stmt=n.then;\n    let _else:Stmt?=n._else;\n    def(n);\n}\n\\v_empty(n:Empty){\n    def(n);\n}\n\\v_funcExprHead(n:FuncExprHead){\n    let name:Token?=n.name;\n    let params:ParamDecls?=n.params;\n    def(n);\n}\n\\v_funcExpr(n:FuncExpr){\n    let head:FuncExprHead=n.head;\n    let body:Compound=n.body;\n    def(n);\n}\n\\v_jsonElem(n:JsonElem){\n    let key:Token=n.key;\n    let value:Expression?=n.value;\n    def(n);\n}\n\\v_objlit(n:Objlit){\n    let elems:JsonElem[]=n.elems;\n    def(n);\n}\n\\v_arylit(n:Arylit){\n    let elems:Expression[]=n.elems;\n    def(n);\n}\n\\v_extends(n:Extends){\n    let superclassName:Token=n.superclassName;\n    def(n);\n}\n\\v_includes(n:Includes){\n    let includeClassNames:Token[]=n.includeClassNames;\n    def(n);\n}\n\\v_program(n:Program){\n    let ext:Extends?=n.ext;\n    let incl:Includes?=n.incl;\n    let stmts:Stmt[]=n.stmts;\n    def(n);\n}\n","//extends TObject;\nextends Actor;\nlet pa=new Panel {\n    x:16,y:16,\n    width:8,height:8,\n    scaleX:1\n};\n$RSprPat=$RSprPat||new RSprPat;\nlet buf='',count=0;\nlet patgen=[], coltbl=[];\nfor(let i=0;\ni<$imageList.length;i++){\n    let l=$imageList [i];\n    if(l.width!=8)continue;\n    if(l.height!=8)continue;\n    if(count>=256)break;\n    count++;\n    pa.clearRect();\n    pa.drawSprite(4,4,i);\n    //updateEx(50);\n    let d=pa.getImageData(\n    0,0,8,8);\n    d=d.data;\n    //print(i);\n    out(d);\n    if (i% 8==0 )updateEx(1);\n    //print(d.data.length);\n}\n//print(patgen.map\\(e){return e.toString(2);},coltbl.map\\(e){return e.toString(16);});\npa.die();\nfireEvent(\"complete\");\n\\out(d){\n    let pals:Color[]=$RSprPat.palette;\n    if (!pals) throw new Error(\"No pals\");\n    for (let y=0;y<8;y++) {\n        let line=[],colc={};\n        for (let x=0;x<8;x++) {\n            let i=(y*8+x)*4;\n            let c=new Color(d[i],d[i+1],d[i+2]);\n            let min=100000, minc=0;\n            for (let i,pal in pals) {\n                let di=c.distHSLA(pal);\n                if (di<min) {\n                    minc=i;\n                    min=di;\n                }\n            }\n            minc++;\n            line.push(minc);\n            colc[minc]=colc[minc]||0;\n            colc[minc]++;\n        }\n        let cols=Object.keys(colc).map\\(e){\n            return e-0;\n        }.sort\\(a,b){\n            return colc[b]-colc[a];\n        };\n        if (cols.length<2) {\n            coltbl.push(cols[0]);\n            patgen.push(0);\n            continue;\n        }\n        let bgc=pals[cols[0]-1];\n        let fgc=pals[cols[1]-1];\n        coltbl.push(cols[1]*16+cols[0]);\n        if (cols[1]*16+cols[0]>=256) {\n            throw new Error(cols+\" \"+(cols[1]*16+cols[0]));\n        }\n        let bits=\"0b\";\n        for (let dot of line) {\n            let bit=cols.indexOf(dot);\n            if (bit<0) throw new Error(cols + \"indexOf \" + dot);\n            if (bit>=2) {\n                let c=pals[cols[bit]-1];\n                let df=fgc.distHSLA(c);\n                let db=bgc.distHSLA(c);\n                bit = (df<db ? 1:0);\n            }\n            bits+=bit;\n        }\n        patgen.push(bits-0);\n    }\n}","extends TObject;\nlet pa=new Panel {\n    x:200,y:200,\n    width:16,height:16,\n    scaleX:10\n};\n\n/*let ide=$Boot.getIDE();\nif (ide) ide.runDialog.resize {\n    left:10,top:300,width:400,\n    height:400\n};*/\nlet buf='',count=0;\nfor(let i=0;\ni<$imageList.length;i++){\n    let l=$imageList [i];\n    if(l.width!=16)continue;\n    if(l.height!=16)continue;\n    if(count>=64)break;\n    count++;\n    pa.clearRect();\n    pa.drawSprite(8,8,i);\n    //updateEx(50);\n    let d=pa.getImageData(\n    0,0,8,16);\n    d=d.data;\n    out(d);\n    d=pa.getImageData(\n    8,0,8,16);\n    d=d.data;\n    out(d);\n    \n    //print(d.data.length);\n}\npa.die();\n\\out(d){\n    let c=\"0b\";\n    let db= [];\n    for(let i=3;i<d.length;\n    i+=4) {\n        c+=(d [i]>128?1:0);\n        if(c.length>=10){\n            c=(c-0).toString(16);\n            c=\"0\"+c+\"h\";\n            db.push(c);\n            c=\"0b\";\n        }\n    }\n    buf+=\"db \"+db+\"\\n\";\n}","extends Actor;\nlet sprpat;\nlet p,c;\nlet dotAlign=1;\n\\spr_scale {\n    return $config[\"spr.scale\"];\n}\n\\new(params) {\n    super(params);\n    if(!$RSprPat) $RSprPat=new RSprPat;\n    sprpat=sprpat||$RSprPat;\n    dotAlign=dotAlign||1;\n    width=$crashTo_size;\n    height=$crashTo_size;\n    //print(width,height);\n    //scaleX=2;\n}\n\\setPalette(n,c){\n    sprpat.palette [n-1]=c;\n}\n\\map_setAt(x,y,p) {\n    $map.set( x>>(3+spr_scale) , y>>(3+spr_scale), $pat_font_orig+p);\n}\n\\map_getAt(x,y) {\n    return $map.get( x>>(3+spr_scale) , y>>(3+spr_scale))-$pat_font_orig;\n}\n\\map_set(x,y,p) {\n    $map.set( x , y, $pat_font_orig+p);\n}\n\\map_get(x,y) {\n    return $map.get( x , y)-$pat_font_orig;\n}\n\\div(x,y) {\n    return floor(x/y);\n}\n\\draw(ctx){\n    let pa:Panel=sprpat.get(p,c);\n    if(pa==null)return;\n    ctx.save();\n    let sx=x,sy=y;\n    x=floor(x/dotAlign)*dotAlign>> spr_scale;\n    y=floor(y/dotAlign)*dotAlign>> spr_scale;\n    performTransform(ctx);\n    /*ctx.drawImage(pa.image,\n    floor(x-pa.width),floor(y-pa.height)\n    );*/\n    ctx.drawImage(pa.image,\n    -floor(pa.width/2),-floor(pa.height/2)\n    );\n    x=sx;y=sy;\n    ctx.restore();\n}\n\\defaultLayer{\n    return $MLayer;\n}\n","extends TObject;\nlet palette=palette||[[0,0,0],\n[64,183,74],[117,207,126],[89,86,215],\n[128,119,239],[184,95,81],\n[102,219,238],[217,102,90],[253,138,126],\n[204,195,96],[222,208,136],\n[59,161,66],[182,103,180],\n[204,204,204],[255,255,255]].map\\(rgb) {\n    return new Color(rgb[0],rgb[1],rgb[2]);\n};\nlet imgs={};\n\\get(p:Number, c:Number) {\n    c=amod(c,(palette.length+1));\n    if (c<=0) return null;\n    let key=`${p}\\t${c}`;\n    if (imgs[key]) return imgs[key];\n    let ls=$imageList[p];\n    if (!ls) return  null;\n    let res=new Panel{width:ls.width, height:ls.height};\n    imgs[key]=res;\n    res.context.drawImage(ls.image, \n    ls.x,ls.y,ls.width,ls.height,\n    0,0,ls.width,ls.height);\n    res.replaceColor(0,0,ls.width, ls.height, palette[c-1]);\n    res.die();\n    return res;\n}\n","extends Visitor;\r\nincludes Buf, Context;\r\nnative Tonyu;\r\ninitModule();\r\nlet IDEPrj=$currentProject.compiler;\r\nlet anodes=waitFor(IDEPrj.serializeAnnotatedNodes());\r\nlet mem=new MemberScan{genasm:this};\r\nlet lval=false;\r\nlet symSeq=1;\r\nlet ide=$Boot.getIDE();\r\nlet klass, klassSrc;\r\nlet problems=[];\r\nlet builtins={getkey:\"getkey\",rnd:\"rnd\"};\r\nlet globals={};\r\nlet keynames={space: 0x0108, \r\nright:0x8008,down:0x4008,up:0x2008,left:0x1008};\r\n//debug=true;\r\nlet opmap={\r\n    \"*\":\"call IMULT.a%n\", \r\n    \"/\":\"call IDIV.a%n\",\r\n    \"%\":\"call IMOD.a%n\",\r\n    \"+\":\"add hl, de%n\",\r\n    \"-\":\"subhl de%n\",\r\n};\r\n\r\nprintf(`org 08000h\r\ninclude tnu\r\ninclude map\r\ninclude bool\r\n\r\nmain:\r\ntnu.run ${$mainClassName}\r\n`);\r\nlet anode;\r\n\\annotation(n) {\r\n    let res=anode[n._id];\r\n    if (!res) {\r\n        return {};\r\n    }\r\n    return res;\r\n}\r\nx=256;y=20;fillStyle=\"black\";\r\nfor (klass of mem.ks) {\r\n    let r=mem.objRange(klass);\r\n    text=klass.shortName;\r\n    //print(\"KLS\",klass);\r\n    printf(\";range %d-%d%n\",r[0],r[1]);\r\n    mem.header(klass);\r\n    klassSrc=klass.src.tonyu.text();\r\n    //print(klass.src.tonyu);\r\n    let methods=klass.decls.methods;\r\n    anode=(klass.annotation);\r\n    for (let mname, me of methods) {\r\n        let method:FuncInfo=me;\r\n        text=klass.shortName+\".\"+mname;\r\n        if (method.params.length>0) {\r\n            unsup(method.params[0],\"Parameters is not yet supported\");\r\n        }\r\n        printf(\"def %s.%s,%d,0%{\",klass.shortName, mname, method.params.length);\r\n        for(let s of method.stmts) visit(s);\r\n        printf(\"enddef %s.%s%n\", klass.shortName, mname);\r\n        printf(\"%}\");\r\n        update();\r\n    }\r\n    update();\r\n}\r\ntext=\"\";\r\nlet outp=new OutPat;\r\nlet outbg=new OutBG;\r\nwaitEvent(outbg,\"complete\");\r\n\r\nprintf(`\r\nendusr:\r\n${Object.keys(globals).map \\(k){\r\n    return globalLabel(k)+\":dw 0\";\r\n}.join(\"\\n\")}\r\nmacro inivrm, n, dst\r\n ld de,dst\r\n ld hl,n\r\n ld bc,end.##n-n\r\n call LDIRVM\r\nendm\r\n\r\nspr.inipat:\r\n inivrm spr.pat, 3800h\r\n ret\r\n\r\nspr.pat:\r\n${outp.buf}\r\nend.spr.pat:\r\n\r\nbg.inipat:\r\n inivrm bg.gen, 0000h\r\n inivrm bg.gen, 0800h\r\n inivrm bg.gen, 1000h\r\n inivrm bg.col, 2000h\r\n inivrm bg.col, 2800h\r\n inivrm bg.col, 3000h\r\n inivrm bg.name, 1800h\r\n ret\r\n\r\nbg.gen:\r\n${toDB(outbg.patgen)}\r\nend.bg.gen:\r\n\r\nbg.col:\r\n${toDB(outbg.coltbl)}\r\nend.bg.col:\r\n\r\nbg.name:\r\n ds 256*3,32\r\nend.bg.name:\r\n\r\nend main`);\r\n/*print(Object.keys(n.decls.fields));\r\nprint(n.superclass.fullName);\r\n*/\r\n//print(\"buf=\"+buf);\r\nlet url=\"https://msxpen.com/codes/-N8klu22ZKY0trVaYX66\";\r\n\r\n//msxpen.com/codes/-N8kjRrkOlaH4vlLV7MY\";\r\n\r\n\r\n//msxpen.com/codes/-N8kZzjv3KL0vbHvgiqT\";\r\n\r\n\r\nnew Button{top:420,text:\"to MSXPen\",onClick:showDiag,fillStyle:$RSprPat.palette[2]};\r\n\\toDB(bytes) {\r\n    let buf=\"\",c=[];\r\n    while(bytes.length) {\r\n        let b=bytes.shift();\r\n        c.push(\"0\"+b.toString(16)+\"h\");\r\n        if (c.length>=8) {\r\n            buf+=\"db \"+c.join(\", \")+\"\\n\";\r\n            c=[];\r\n        }\r\n    }\r\n    if (c.length) buf+=\"db \"+c.join(\", \")+\"\\n\";\r\n    return buf;\r\n}\r\n\\showDiag() {\r\n    //msxpen.com/codes/-N8fnpcspSXEqEJ4lOeO\";\r\n    if (problems.length) {\r\n        let tx=new HTMLUI{\r\n            content:[\"div\",\r\n            {style:'background: #fee;'},\r\n            [\"h2\",\"Problem(s) found\"],\r\n            [\"ul\"].concat(\r\n            problems.map\\(p) {\r\n                return [\"li\",[\"a\",{\r\n                    href:\"javascript:;\",\r\n                    onclick: \\{\r\n                        ide.jump(p.file, p.row, p.col);  \r\n                    }\r\n                },\r\n                p.file.name(),\":\",p.row,\":\",p.col,\" - \",p.mesg\r\n                ]];\r\n            }),\r\n            [\"button\",{onclick:\\{tx.die();}},\"Close\"]\r\n            ],\r\n            left:10, top: 20, width:300,\r\n            height:400,\r\n        };\r\n        return;\r\n    }\r\n    let tx=new HTMLUI{\r\n        content:[\"div\",\r\n        {style:'background: #eee;'},\r\n        [\"h2\",\"Code copied!\"],\r\n        [\"ul\",\r\n        [\"li\",\r\n        \"Open \",\r\n        [\"a\",{target:\"pen\",href:url},\r\n        \"this MSXpen page \"],\r\n        \".\"],\r\n        [\"li\",\"Paste the copied code\",\r\n        \" to 'Asm' tab.\"]],\r\n        [\"textarea\",{rows:\"10\", cols:\"30\",name:\"val\"},\r\n        \"test\\ndesu\"],\r\n        [\"button\",{onclick:\\{tx.die();}},\"Close\"]\r\n        ],\r\n        left:10, top: 20, width:300,\r\n        height:400,\r\n    };\r\n    if (getkey(\"n\")) {\r\n        tx.setValue(\"val\", buf+\"\");\r\n    } else {\r\n        let cg=new Includer;\r\n        tx.setValue(\"val\", cg.gensrc(buf+\"\"));\r\n    }\r\n    tx.copyToClipboard(\"val\");\r\n}\r\n\r\n\\def(n){\r\n    if(!n){\r\n        print(n);\r\n        return;\r\n    }\r\n    print(n.type,\":\",\r\n    Object.keys(n));\r\n    unsup(n);\r\n}\r\n\\unsup(n:TNode, mesg:String) {\r\n    mesg=mesg|| \"Unsupported syntax\";\r\n    let file=klass.src.tonyu;\r\n    let rc=Tonyu.TError.calcRowCol(klassSrc,n.pos);\r\n    let p={file, row:rc.row, col: rc.col, mesg};\r\n    problems.push(p);\r\n    //ide.jump( file, rc.row, rc.col);\r\n    print(p.file.name(),\":\",p.row,\":\",p.col,\" - \",p.mesg);\r\n}\r\n\\v_program(n:Program){\r\n    let ext:Extends?=n.ext;\r\n    let incl:Includes?=n.incl;\r\n    let stmts:Stmt[]=n.stmts;\r\n    for (let s of stmts){\r\n        visit(s);\r\n    }\r\n    printf(\"ret%n\");\r\n}\r\n\\v_parenExpr(n:ParenExpr) {\r\n    visit(n.expr);\r\n}\r\n\\extractSrc(n:TNode) {\r\n    return klassSrc.substring(n.pos, n.pos+n.len);\r\n}\r\n\\v_exprstmt(n:Exprstmt){\r\n    let expr:Expression=n.expr;\r\n    printf(\";%s%n\", extractSrc(n).replace(/[\\r\\n]/g,\"\"));\r\n    visit(expr);\r\n}\r\n\\v_infix(n:Infix){\r\n    let left:Expression=n.left;\r\n    let op:Token=n.op;\r\n    let right:Expression=n.right;\r\n    switch(op.text){\r\n        case \"=\":\r\n        assign(n);\r\n        break;\r\n        case \"+\":case \"-\":\r\n        case \"*\":case \"/\":case \"%\":\r\n        arith(n);\r\n        break;\r\n        case \"==\":case \"!=\":\r\n        case \"<=\":case \">=\":\r\n        case \"<\":case \">\":\r\n        cmp(n);\r\n        break;\r\n        case \"+=\":case \"-=\":\r\n        case \"*=\":case \"/=\":case \"%=\":\r\n        arithEq(n);\r\n        break;\r\n        case \"&&\":andand(left,right);break;\r\n        case \"||\":oror(left,right);break;\r\n        default:\r\n        unsup(n,`Unsupported infix operator '${op.text}'`);\r\n    }\r\n}\r\n\\andand(left: Expression, right:Expression) {\r\n    let n=genSym();\r\n    visit(left);\r\n    printf(\"andand %s%n\",n);\r\n    visit(right);\r\n    printf(\"%s:%n\",n);\r\n}\r\n\\oror(left: Expression, right:Expression) {\r\n    let n=genSym();\r\n    visit(left);\r\n    printf(\"oror %s%n\",n);\r\n    visit(right);\r\n    printf(\"%s:%n\",n);\r\n}\r\n\r\n\\isMemberRef(m:Expression) {\r\n    if (m.type!==\"postfix\") return null;\r\n    let tgme:Postfix=m;\r\n    if (tgme.op.type!==\"member\") return null;\r\n    let mem: Member=tgme.op;\r\n    return [tgme.left, mem.name];\r\n}\r\n\\v_postfix(n:Postfix){\r\n    let left:Expression=n.left;\r\n    let op:TNode=n.op;\r\n    if (!lval) {\r\n        let tgme=isMemberRef(n);\r\n        if (tgme) {\r\n            visit(tgme[0]);\r\n            printf(\"getfldtg .%s%n\",tgme[1]);\r\n            return;\r\n        } else if (op.type===\"call\") {\r\n            if (left.type===\"varAccess\") {\r\n                return myMeth(left, op);            \r\n            } else {\r\n                let tgme=isMemberRef(left);\r\n                if (tgme) {\r\n                    tgMeth(tgme[0], tgme[1], op);\r\n                    return;\r\n                }\r\n                unsup(n, `Not a member Ref `);\r\n            }\r\n        }\r\n    } else {\r\n        let tgme=isMemberRef(n);\r\n        if (tgme) {\r\n            printf(\"push hl%n\");\r\n            enter{lval:false} \\{\r\n                visit(tgme[0]);\r\n            };\r\n            printf(\"setfldtg .%s%n\",tgme[1]);\r\n            return;\r\n        }\r\n    }\r\n    unsup(n,`Unsupported postfix operator '${op.text}' (${op.type})`);\r\n}\r\n\\tgMeth(target: Expression, name:Token, op:Call) {\r\n    printf(\"pushthis 0%n\");\r\n    let args=op.args;\r\n    for(let a of args){\r\n        visit(a);\r\n        printf(\"push hl%n\");\r\n    }\r\n    visit(target);\r\n    printf(\"invoketg.a .%s%n\",name);\r\n    printf(\"popthis 0%n\");\r\n    /*\r\n    pushthis 0\r\n   ld hl,(right)\r\n   invoketg.a .push\r\n   popthis 0*/\r\n}\r\n\\myMeth(left: VarAccess, op:Call) {\r\n    let args=op.args;\r\n    let mname=left.name.text;\r\n    if (mname===\"getkey\") {\r\n        if (!args[0]) {\r\n            unsup(left, \"'getkey' should give a string constant.\");\r\n        } else {\r\n            let kn=args[0];\r\n            if (kn.type===\"literal\") {\r\n                let lit:Token=kn;\r\n                let s=lit.text;\r\n                s=s.substring(1,s.length-1);\r\n                if (!keynames[s]) {\r\n                    unsup(kn, `Undefined key name '${s}'.`);\r\n                }\r\n                printf(\"ld hl, %s%n\", keynames[s]);\r\n                printf(\"call getkey%n\");\r\n            } else {\r\n                unsup(kn,`'${kn.type}' is not a string constant `);\r\n                //print(kn.type);\r\n            }\r\n        }\r\n    } else if (mname===\"rnd\") {\r\n        if (!args[0]) {\r\n            unsup(left, \"'rnd' should give a number.\");\r\n        }\r\n        visit(args[0]);\r\n        printf(\"call rnd%n\");\r\n    } else if (mname===\"abs\") {\r\n        if (!args[0]) {\r\n            unsup(left, \"'abs' should give a number.\");\r\n        }\r\n        visit(args[0]);\r\n        printf(\"call abs%n\");\r\n    } else if (mname.match(/^map_set(At)?/)) {\r\n        if (args.length!==3) {\r\n            unsup(left, \"'map_set(At) should give (x,y,p)\");\r\n        }\r\n        visit(args[1]); // y\r\n        printf(\"push hl%n\");\r\n        visit(args[0]); // x\r\n        printf(\"push hl%n\");\r\n        visit(args[2]); // p\r\n        printf(\"ld a,l%n\");\r\n        printf(\"pop hl%n\");\r\n        printf(\"pop de%n\");\r\n        printf(\"call map.set%s.a%n\",\r\n        mname.match(/At/)?\"at\":\"\");\r\n        printf(\"getthis 0%n\");\r\n    } else if (mname.match(/^map_get(At)?/)) {\r\n        if (args.length!==2) {\r\n            unsup(left, \"'map_get(At) should give (x,y)\");\r\n        }\r\n        visit(args[1]); // y\r\n        printf(\"push hl%n\");\r\n        visit(args[0]); // x\r\n        printf(\"pop de%n\");\r\n        printf(\"call map.get%s.a%n\",\r\n        mname.match(/At/)?\"at\":\"\");\r\n        printf(\"ld h,0%n\");\r\n        printf(\"ld l,a%n\");\r\n        printf(\"getthis 0%n\");\r\n\r\n    } else if (mname===\"crashTo\") {\r\n        let tg=args[0];\r\n        if (!tg) {\r\n            unsup(left, \"'crashTo' should give a object or Class.\");\r\n        }\r\n        let klass=(tg.type===\"varAccess\" && isClassConst(tg));\r\n        if (klass) {\r\n            let range=mem.objRange(klass);\r\n            printf(\"crashToClass %s, %d, %d%n\",klass.shortName,range[0],range[1]);\r\n            /*printf(\"call crashTo.setXY%n\");\r\n            printf(\"ld hl,%s%n\",klass.shortName);\r\n            printf(\"const crashTo.kls,hl%n\");\r\n            printf(\"ld hl,%s%n\",rangeToAd(range[0]));\r\n            printf(\"ld de,%s%n\",rangeToAd(range[1]));\r\n            printf(\"call crashToC%n\");*/\r\n        } else {\r\n            visit(tg);\r\n            printf(\"call crashTo1%n\");\r\n            printf(\"flagtobool c%n\");\r\n        }\r\n    } else if (mname===\"div\") {\r\n        if (args.length!==2) {\r\n            return unsup(\"'div' should supply 2 numbers\");\r\n        }\r\n        arith2(args[0],\"/\",args[1]);\r\n    } else {\r\n        for(let a of args){\r\n            visit(a);\r\n            printf(\"push hl%n\");\r\n        }\r\n        printf(\"invoke .%s%n\", mname);\r\n    }\r\n}\r\n\\cmp(n:Infix){\r\n    let left:Expression=n.left;\r\n    let op:Token=n.op;\r\n    let right:Expression=n.right;\r\n    let ops={\r\n        \"==\":\"eq\",\"!=\":\"ne\",\r\n        \"<=\":\"le\",\">=\":\"ge\",\r\n        \"<\":\"lt\",\">\":\"gt\",\r\n    };\r\n    visit(right);\r\n    printf(\"push hl%n\");\r\n    visit(left);\r\n    printf(\"pop de%n\");\r\n    printf(\"call hl%sde%n\",ops[op.text]);\r\n}\r\n\\arith(n:Infix){\r\n    let left:Expression=n.left;\r\n    let op:Token=n.op;\r\n    let right:Expression=n.right;\r\n    arith2(left,op.text, right);\r\n}\r\n\\arith2(left:Expression, opr:String, right:Expression) {\r\n    switch(opr) {\r\n        case \"*\":case \"/\":case \"%\":\r\n        printf(\"pushthis%n\");\r\n        visit(left);\r\n        printf(\"push hl%n\");\r\n        visit(right);\r\n        printf(\"pop de%n\");\r\n        printf(opmap[opr]);\r\n        printf(\"popthis%n\");\r\n        break;\r\n        case \"+\":case \"-\":\r\n        visit(right);\r\n        printf(\"push hl%n\");\r\n        visit(left);\r\n        printf(\"pop de%n\");\r\n        printf(opmap[opr]);\r\n        break;\r\n        default:\r\n        unsup(left, `Invalid op ${opr}`);\r\n    }\r\n}\r\n\\arithEq(n:Infix) {\r\n    let left:Expression=n.left;\r\n    let op:Token=n.op;\r\n    let right:Expression=n.right;\r\n    arith2(left, op.text.substring(0,op.text.length-1), right);\r\n    enter{lval:true} \\{\r\n        visit(left);\r\n    };\r\n    /*if (left.type!==\"varAccess\") {\r\n        return unsup(`Only field${op.text}=... is supported `);\r\n    }\r\n    let a=annotation(left);\r\n    switch (a.scopeInfo.type) {\r\n        case \"field\":\r\n\r\n        break;\r\n        case \"class\":\r\n        unsup(n,`Cannot assign to class '${name}'.`);\r\n        break;\r\n        default:\r\n        unsup(n,`${name}: Unsupported variable type '${a.scopeInfo.type}'`);\r\n    }\r\n\r\n    \r\n    let s=`\r\n        macro getfld, n\r\n        local ad\r\n        ld (ad-1),a\r\n        ld hl,(n)\r\n        ad:\r\n        endm\r\n\r\n        macro setfld, n\r\n        local ad\r\n        ld (ad-1),a\r\n        ld (n),hl\r\n        ad:\r\n        endm\r\n        `;*/\r\n}\r\n\\assign(n:Infix){\r\n    let left:Expression=n.left;\r\n    let op:Token=n.op;\r\n    let right:Expression=n.right;\r\n    visit(right);\r\n    enter{lval:true} \\{\r\n        visit(left);\r\n    };\r\n}\r\n\\v_reservedConst(n:Token) {\r\n    if (n.text===\"true\" || n.text===\"false\") {\r\n        printf(\"ld hl,%s%n\",n.text);\r\n    } else if (n.text===\"this\") {\r\n        printf(\"ld h,a%n\");\r\n        printf(\"ld l,0%n\");\r\n        return;\r\n    } else {\r\n        unsup(n,`Unsupported reserved word '${n.text}'.`);\r\n    }\r\n}\r\n\\v_number(n:Token){\r\n    printf(\"ld hl,%d%n\",n.text-0);\r\n}\r\n\\globalLabel(n:String) {\r\n    return `gbl_${n.replace(/\\$/g,\"\")}`;\r\n}\r\n\\v_varAccess(n:VarAccess){\r\n    let name:Token=n.name;\r\n    let a=annotation(n);\r\n    switch (a.scopeInfo.type) {\r\n        case \"field\":\r\n        if (lval) {\r\n            printf(\"setfld .%s%n\",name);\r\n        } else{\r\n            printf(\"getfld .%s%n\",name);\r\n        }\r\n        break;\r\n        case \"class\":\r\n        if (lval) {\r\n            unsup(n,`Cannot assign to class '${name}'.`);\r\n        } else{\r\n            printf(\"ld hl,%s%n\",name);\r\n        }\r\n        break;\r\n        case \"global\":\r\n        globals[name.text]=1;\r\n        if (lval) {\r\n            printf(\"ld (%s),hl%n\",globalLabel(name.text));\r\n        } else {\r\n            printf(\"ld hl,(%s)%n\",globalLabel(name.text));\r\n        }\r\n        break;\r\n        default:\r\n        unsup(n,`${name.text}: Unsupported variable type '${a.scopeInfo.type}'`);\r\n    }\r\n}\r\n\\genSym() {\r\n    return \"lb\"+(symSeq++);\r\n}\r\n\\v_compound(n:Compound) {\r\n    for (let s of n.stmts) {\r\n        visit(s);\r\n    }\r\n}\r\n\\v_while(n:While){\r\n    let cond:Expression=n.cond;\r\n    let loop:Stmt=n.loop;\r\n    let sh=genSym();\r\n    let se=genSym();\r\n    printf(\"%s:%n\",sh);\r\n    visit(cond);\r\n    printf(\"jpf %s%n\",se);\r\n    visit(loop);\r\n    printf(\"jp %s%n\",sh);\r\n    printf(\"%s:%n\",se);\r\n}\r\n\r\n\\v_for(n:For){\r\n    let inFor:ForHead=n.inFor;\r\n    let loop:Stmt=n.loop;\r\n    if (inFor.type===\"normalFor\") {\r\n        let h:NormalFor=inFor;\r\n        let init:Stmt=h.init;\r\n        let cond:Expression?=h.cond;\r\n        let next:Expression?=h.next;\r\n        let sh=genSym();\r\n        let se=genSym();\r\n        visit(init);\r\n        printf(\"%s:%n\",sh);\r\n        visit(cond);\r\n        printf(\"jpf %s%n\",se);\r\n        visit(loop);\r\n        visit(next);\r\n        printf(\"jp %s%n\",sh);\r\n        printf(\"%s:%n\",se);\r\n    } else {\r\n        let h:Forin=inFor;\r\n        let isVar:Token?=h.isVar;\r\n        let vars:Token[]=h.vars;\r\n        let inof:Token=h.inof;\r\n        let set:Expression=h.set;\r\n        let klass=isAll(set);\r\n        if (!klass) {\r\n            unsup(set,\"only 'for (e of all(Class))' is allowed \");\r\n            return;\r\n        }\r\n        //foreach.a, Class,st,en,nx\r\n        let range=mem.objRange(klass);\r\n        let nx=genSym();\r\n        printf(\"foreach.a %s, %d, %d, %s%{\",klass.shortName,range[0],range[1],nx);\r\n        let va=annotation(vars[0]);\r\n        //print (va);\r\n        if (va.scopeInfo.type===\"field\") {\r\n            printf(\"setfld .%s%n\", vars[0].text);\r\n        } else {\r\n            unsup(vars,\"only field supports\");\r\n        }\r\n        visit(loop);\r\n        printf(\"continue%n\");\r\n        printf(\"%}%s:%n\",nx);\r\n        printf(\"getthis 0%n\");\r\n    }\r\n}\r\n\\isAll(set:Expression) {\r\n    if (set.type!==\"postfix\") return false;\r\n    let p:Postfix=set;\r\n    if (p.op.type!==\"call\") return false;\r\n    let c:Call=p.op;\r\n    if (p.left.type!==\"varAccess\") return false;\r\n    let a:VarAccess=p.left;\r\n    if (a.name.text!==\"all\") return false;\r\n    if (c.args.length!==1) return false;\r\n    let k=c.args[0];\r\n    return k.type===\"varAccess\" && isClassConst(k);\r\n}\r\n\\v_if(n:If){\r\n    let cond:Expression=n.cond;\r\n    let then:Stmt=n.then;\r\n    let _else:Stmt?=n._else;\r\n    let send=genSym();\r\n    let sels=genSym();\r\n    visit(cond);\r\n    printf(\"jpf %s%n\",sels);\r\n    visit(then);\r\n    printf(\"jp %s%n\",send);\r\n    printf(\"%s:%n\",sels);\r\n    if (_else) visit(_else);\r\n    printf(\"%s:%n\",send);\r\n}\r\n\r\n\r\n\\v_varDecl(n:VarDecl){\r\n    let name:Token=n.name;\r\n    let typeDecl:TypeDecl?=n.typeDecl;\r\n    let value:Expression?=n.value;\r\n    let a=annotation(n);\r\n    if (!a.varInMain) {\r\n        unsup(n,\"Local Variables are not yet supported.\");\r\n        return;\r\n    }\r\n    if (!value) return;\r\n    visit(value);\r\n    printf(\"setfld .%s%n\",name);\r\n}\r\n\\v_varsDecl(n:VarsDecl){\r\n    let decls:VarDecl[]=n.decls;\r\n    if (n.declPrefix.text!==\"var\") {\r\n        unsup(n,\"let or const are not supported.\");\r\n    }\r\n    for(let d of decls){\r\n        visit(d);\r\n    }\r\n}\r\n\\rangeToAd(r) {\r\n    return `th.start+${r}*th.size`;\r\n}\r\n\\isClassConst(klass:VarAccess) {\r\n    let a=annotation(klass);\r\n    if (a.scopeInfo.type!==\"class\") {\r\n        return null;\r\n    }\r\n    return a.scopeInfo.info;\r\n}\r\n\\v_newExpr(n:NewExpr){\r\n    let klass:VarAccess=n.klass;\r\n    let params:Call?=n.params;\r\n    if (params.args.length==1 && params.args[0].type==\"objlit\") {\r\n        let objlit:Objlit=params.args[0];\r\n        let elems:JsonElem[]=objlit.elems;\r\n        for (let elem of elems) {\r\n            if (elem.value) {\r\n                visit(elem.value);\r\n            } else {\r\n                printf(\"getfld .%s%n\",elem.key);\r\n            }\r\n            printf(\"new.arg .%s%n\",elem.key);\r\n        }\r\n        let resKlass=isClassConst(klass);\r\n        if (!resKlass) {\r\n            unsup(klass , `Only class name is allowed`);\r\n        }\r\n        let range=mem.objRange(resKlass);\r\n        printf(\"new %s,%d,%s,%s%n\",\r\n        klass.name, elems.length,\r\n        range[0], range[1]);\r\n        //rangeToAd(range[0]),rangeToAd(range[1]));\r\n        return;\r\n    }\r\n    unsup(n,`'new ${klass.name}' can be followed by only {key:value...}`);\r\n}\r\n","extends null;\nincludes TNode;\nlet args:Expression[];\n","extends null;\nincludes TNode;\nlet subscript:Expression;\n","extends null;\nincludes TNode,Stmt;\nlet brk:Token;\n","extends null;\nincludes TNode;\nlet args:Expression[];\n","extends null;\nincludes TNode;\nlet value:Expression;\nlet stmts:Stmt[];\n","extends null;\nincludes TNode;\nlet name:Token;\nlet stmt:Stmt;\n","extends null;\nincludes TNode,Stmt;\nlet stmts:Stmt[];\n","extends null;\nincludes TNode,Stmt;\nlet cont:Token;\n","extends null;\nincludes TNode;\nlet stmts:Stmt[];\n","extends null;\nincludes TNode,Stmt;\nlet loop:Stmt;\nlet cond:Expression;\n","extends null;\nincludes TNode,Stmt;\nlet expr:Expression;\n","extends null;\nincludes TNode;\nlet superclassName:Token;\n","extends null;\nincludes TNode;\nlet stmt:Stmt;\n","extends null;\nincludes TNode,Stmt;\nlet inFor:ForHead;\nlet loop:Stmt;\n","extends ForHead;\r\nincludes TNode;\r\nlet isVar:Token?;\r\nlet vars:Token[];\r\nlet inof:Token;\r\nlet set:Expression;\r\n\r\n","extends null;\nincludes TNode,Stmt;\nlet head:FuncDeclHead;\nlet body:Compound;\n","extends null;\nincludes TNode;\nlet _nowait:Token?;\nlet ftype:Token?;\nlet name:Token;\nlet setter:SetterDecl?;\nlet params:ParamDecls?;\nlet rtype:TypeDecl?;\n","extends null;\nincludes TNode,ObjOrFuncArg;\nlet obj:FuncExpr;\n","extends null;\nincludes TNode;\nlet name:Token?;\nlet params:ParamDecls?;\n","extends null;\nincludes TNode,Stmt;\nlet cond:Expression;\nlet then:Stmt;\nlet _else:Stmt?;\n","extends null;\nincludes TNode,Stmt;\nlet then:Stmt;\nlet _else:Stmt?;\n","extends null;\nincludes TNode;\nlet includeClassNames:Token[];\n","extends null;\nincludes Expression;\nlet left:Expression;\nlet op:Token;\nlet right:Expression;\n","extends null;\nincludes TNode;\nlet key:Token;\nlet value:Expression?;\n","extends null;\nincludes TNode;\nlet name:Token;\n","extends null;\nincludes TNode,Stmt;\nlet name:Token;\n","extends ForHead;\r\nincludes TNode;\r\nlet init:Stmt;\r\nlet cond:Expression?;\r\nlet next:Expression?;\r\n","extends null;\nincludes TNode,ObjOrFuncArg;\nlet obj:Objlit;\n","extends null;\nincludes TNode;\nlet name:Token;\nlet typeDecl:TypeDecl?;\n","extends null;\nincludes TNode;\nlet params:ParamDecl[];\n","extends null;\nincludes Expression;\nlet left:Expression;\nlet op:TNode;\n","extends null;\nincludes Expression;\nlet op:Token;\nlet right:Expression;\n","extends null;\nincludes TNode;\nlet ext:Extends?;\nlet incl:Includes?;\nlet stmts:Stmt[];\n","extends null;\nincludes TNode,Stmt;\nlet value:Expression?;\n","extends null;\nincludes TNode;\nlet args:Expression[];\n","extends null;\nincludes TNode;\nlet value:ParamDecl;\n","extends null;\nincludes TNode,Stmt;\nlet value:Expression;\nlet cases:Case[];\nlet defs:Default?;\n","extends null;\nincludes TNode,Stmt;\nlet ex:Expression;\n","extends null;\nincludes Expression;\nlet left:Expression;\nlet op1:Token;\nlet mid:Expression;\nlet op2:Token;\nlet right:Expression;\n","extends RSprite;\nlet x,y,p,c;\n//\\getkey(){}\n/*\\new(params){\n    super(params);\n    if (!$exporter){\n        $exporter=new GenAsm;\n    }\n}*/\n\\die(){super.die();}\n\\crashTo(e){return super.crashTo(e);}\n\\update(){super.update();}\n\\updateEx(n){super.updateEx(n);}\n\\onUpdate (){}\n\\screenOut(){\n    return x<0 || x>$MScreen.width<<spr_scale || \n    y<0 || y>$MScreen.height<<spr_scale;\n}\n","\nvar vx,vy;\np=7;\nc=15;\nwhile(true) {\n    x+=vx;\n    y+=vy;\n    if (screenOut()) die();\n    if (map_getAt(x,y)==1) {\n        map_setAt(x,y,32);\n        die();\n    }\n    update();\n}","var vx;\nwhile(y<200) {\n    y+=2;\n    update();\n}\nif (x>$player.x) vx=0-2;\nelse vx=2;\n//print(y,$MScreen.height);\nfire();\nwhile(true) {\n    if (screenOut()) die();\n    y+=2;\n    x+=vx;\n    map_setAt(x,y,32);\n    update();\n}\nvar bvx,bvy,bdist;//TODO: move to fire, local var\nfunction fire() {\n    bvx=$player.x-x;\n    bvy=$player.y-y;\n    bdist=abs(bvx)+abs(bvy);\n    bdist/=8;\n    if (bdist>0) {\n        bvx/=bdist;\n        bvy/=bdist;\n        new EBullet{\n            x,y,vx:bvx,vy:bvy\n        };\n    }\n}","/*\r\nFor details:\r\nhttps://github.com/hoge1e3/reTrONew\r\n*/\r\n$player=new Player{x:256, y: 300, p:$pat_spr+4, c:15};\r\nvar i=0, tmps;\r\n$score=0;\r\nwhile(true) {\r\n    new Enemy{x:rnd(512), y:0, p:5, c:7};\r\n    updateEx(30);\r\n    showScore();\r\n    //i+=1;\r\n}\r\nfunction showScore() {\r\n    tmps=$score;\r\n    for (i=5;i>1;i-=1){\r\n        map_set(i,1,tmps%10+48);\r\n        tmps=div(tmps,10);\r\n    }\r\n}","p=6;\r\nc=8;\r\nwhile (true) {\r\n    if (screenOut()) die();\r\n    y-=6;\r\n    var e=crashTo(Enemy);\r\n    if (e) {\r\n        e.die();\r\n        die();\r\n        $score+=10;\r\n    }\r\n    if (map_getAt(x,y-16)==1){\r\n        map_setAt(x,y-16,32);\r\n        die();\r\n    }\r\n    update();\r\n}\r\n\\onUpdate() {\r\n    //var t;\r\n    c+=1;\r\n    if (c>14) c=0;\r\n}","while(true) {\r\n    map_setAt(x,y,$pat_font+1);\r\n    if (getkey(\"left\")) x-=3;\r\n    if (getkey(\"right\")) x+=3;\r\n    if (getkey(\"up\")) y-=3;\r\n    if (getkey(\"down\")) y+=3;\r\n    // TODO combine these crashTo with hierarchical index\r\n    //   AbstractEnemy <- {Enemy, EBullet}\r\n    if (crashTo(Enemy)) {\r\n        die();\r\n    }\r\n    if (crashTo(EBullet)) {\r\n        die();\r\n    }\r\n    if (getkey(\"space\")==1) {\r\n        new PBullet{x,y};\r\n        var e;\r\n        var r=rnd(10)+1;\r\n        for (e of all(Enemy)) {\r\n            e.c=r;\r\n        }\r\n    }\r\n    update();\r\n    \r\n}","extends null;\nincludes TNode,Elem;\nlet head:FuncExprHead;\nlet body:Compound;\n","extends null;\nincludes TNode,Elem;\nlet klass:VarAccess;\nlet params:Call?;\n","extends null;\nincludes TNode,Elem;\nlet elems:JsonElem[];\n","extends null;\nincludes TNode,Elem;\nlet expr:Expression;\n","extends null;\nincludes TNode,Elem;\nlet name:Token?;\nlet params:Scall;\n","extends null;\nincludes Elem;\nlet text:String;\n","extends null;\nincludes TNode,Elem;\nlet name:Token;\n","extends null;\nincludes TNode,Elem;\nlet elems:Expression[];\n"]}